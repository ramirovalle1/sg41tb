{% extends "formbs.html" %}
{% load sga_extras %}
{% block heading %}
     <script type="text/javascript">
        $(function() {
            var d=0;
            var m=0;
            var ins=0;
            var idregistroestu=0;
            $('#id_horas').addClass('input-small');
            $('#id_horas2').addClass('input-small');
            $('#id_horasmod').addClass('input-small');
            $("#search").click(function() {
                    var term = $("#searchfield").val().toUpperCase();
                    location.href = "/vinculacion?action=participantes&id={{ vinculacion.id }}&s="+term;
            });

            $('#searchfield').keyup(function(e) {
                if(e.keyCode == 13) {
                    $("#search").trigger("click");
                }
            });
        $(".eliminaact").click(function(){
             var id = $(this).attr("idact");
             smoke.confirm('Se eliminara la actividad asignada al estudiante', function(e){
                if (e){
                    location.href = '/vinculacion?action=eliminaractividad&id='+id;
                }else{
                }
                }, {
                ok: "CONTINUAR",
                cancel: "CANCELAR",
                classname: "custom-class",
                reverseButtons: true
            });
        });

        $(".btn-danger").click(function(){
                 var id = $(this).attr("iid");
                 smoke.confirm('Se eliminara el registro', function(e){
                    if (e){
                        location.href = '/vinculacion?action=eliminarins&id='+id;
                    }else{
                    }
                    }, {
                    ok: "CONTINUAR",
                    cancel: "CANCELAR",
                    classname: "custom-class",
                    reverseButtons: true
                });
            });

        buscar_participantes = function(query, process) {
            $.get("/reportes", {'action':'data', 'model': 'Nivel',
                'p': 1, 'q': query, 's': 10}, function(data) {
                if (data.results) {
                    $("#id_grupo").get(0).results = data.results;
                    listing = [];
                    for (var i in data.results) {
                        var dato = data.results[i];
                        listing.push(dato.name);
                    }
                    process(listing);
                }
            }, 'json');
        };

            var numeros="0123456789";

        function solo_numeros(texto){
            var num = 0;
                for(i=0; i<texto.length; i++){
                    if (numeros.indexOf(texto.charAt(i),0)!=-1){
                    num = num +1;
                }
            }
        return num;
        }

        $("#id_horas").blur(function(){
            var v = $("#id_horas").val();
            var idnivel =$("#id_nivelmallaind").val();
            if (idnivel==''){
                $($("#id_horas").get(0).parentNode).find(".help-text").html("");
                $($("#id_horas").get(0).parentNode).find(".help-text").html("<span style='color: darkred'><i>Debe seleccionar el nivel</i></span>"  );
            }
            var p = solo_numeros(v);
            if (p != v.length)
            {
              $($("#id_horas").get(0).parentNode).find(".help-text").html("Ingresar solo Numeros");
              $("#id_horas").val("");
              $("#id_horas").focus();
              $("#participantes_panel_indivudual .btn-buscar").show();
            }
            else{
                //if ($("#id_horas").val() <= {{h_vinculacion}}){
                    $($("#id_horas").get(0).parentNode).find(".help-text").html("");

                    $.get("/vinculacion", {action: 'h_vinculacion', horas: $("#id_horas").val(),id:ins,nivelmalla:idnivel}, function(data) {
                        if (data.result=='bad1') {
                            $($("#id_horas").get(0).parentNode).find(".help-text").html("");
                            $($("#id_horas").get(0).parentNode).find(".help-text").html("<span style='color: darkred'><i>Estudiante tiene " +  data.horas + " horas de vinculaci&oacute;n" + "</i></span>"  );
{#                            $("#participantes_panel_indivudual .btn-buscar").hide();#}
                            }
                        if (data.result=='bad2') {
                            $($("#id_horas").get(0).parentNode).find(".help-text").html("");
                            $($("#id_horas").get(0).parentNode).find(".help-text").html("<span style='color: darkblue'><i>Horas de vinculaci&oacute;n completas " +  data.horas + "</i></span>"  );
{#                            $("#participantes_panel_indivudual .btn-buscar").hide();#}
                            }
                        if (data.result=='bad3') {
                            $($("#id_horas").get(0).parentNode).find(".help-text").html("");
                            $($("#id_horas").get(0).parentNode).find(".help-text").html("<span style='color: darkred'><i>" +  data.horas + " horas de vinculaci&oacute;n" + "</i></span>"  );
{#                            $("#participantes_panel_indivudual .btn-buscar").hide();#}
                            }
                        if (data.result=='ok') {
                            $($("#id_horas").get(0).parentNode).find(".help-text").html("");
                            $($("#id_horas").get(0).parentNode).find(".help-text").html("<span style='color: darkorange'><i>El estudiante tiene " +  data.horas + " horas de vinculaci&oacute;n" + "</i></span>"  );
{#                            $("#participantes_panel_indivudual .btn-buscar").show();#}
                            }
                        }, "json");
                //}
                //else {
                  //  $($("#id_horas").get(0).parentNode).find(".help-text").html("<span style='color: darkgreen'><i>Las horas de vinculaci&oacute;n son " + {{h_vinculacion}}+ "</i></span>"  );
{#                    $("#participantes_panel_indivudual .btn-buscar").hide();#}
                //}
            }
        });


        $('#id_grupo').typeahead({source: buscar_participantes, updater: function(item) {
            var results = $("#id_grupo").get(0).results;
            for (var i in results) {
                var datos = results[i];
                if (item==datos.name) {

                    $("#id_grupo").attr("myval",datos.id);
                    d=datos.id;
                    $("#id_grupo").val(d);
                }
            }
            return item;
        }});

        $("#participantes_panel .btn-cerrar").click(function() {
            $("#id_horas2").val("");
            $("#id_sinarticuladagrupo").attr('checked',false);
            $("#participantes_panel").modal("hide");
            return false;
        });

        $("#participantes_panel .btn-buscar").click(function() {
            var horas = $("#id_horas2").val();

            var idnivel =$("#id_nivelmalla").val();

            var v = $("#id_horas2").val();
            var p = solo_numeros(v);
            if (p != v.length)
            {
              $($("#id_horas2").get(0).parentNode).find(".help-text").html("Ingresar solo Numeros");
              $("#id_horas2").val("");
              $("#id_horas2").focus();
              $("#participantes_panel .btn-buscar").show();
            }

             if (parseInt(idnivel)>0){

                    if(parseInt(d)>0){

                              if (v>0){

                                    $("#participantes_panel").modal("hide");
                                    smoke.confirm('Esta seguro que desea Agregar este Grupo', function(e){
                                            if (e){
                                                if (document.getElementById('id_sinarticuladagrupo').checked){
                                                    location.href = "/vinculacion?action=buscar&id="+d+"&vinculacion="+'{{ vinculacion.id }}'+"&horas="+horas+"&idnivel="+idnivel;
                                                }else{
                                                    location.href = "/vinculacion?action=buscarsinarticulada&id="+d+"&vinculacion="+'{{ vinculacion.id }}'+"&horas="+horas+"&idnivel="+idnivel;
                                                }

                                            }else{

                                                $("#participantes_panel").modal("show");
                                                $("#id_grupo").val("");
                                            }
                                            }, {
                                            ok: "CONTINUAR",
                                            cancel: 'CANCELAR',
                                            classname: "custom-class",
                                            reverseButtons: true
                                    });

                              }else{
                                  $("#participantes_panel").modal("hide");
                                  smoke.alert("La hora debe ser mayor a Cero");
                              }

                    }else{
                        $("#participantes_panel").modal("hide");
                        smoke.alert("Debe Seleccionar Grupo");
                    }

             }else{
                smoke.alert("Debe Seleccionar el Nivel");
                $("#participantes_panel").modal("hide");
             }

        });


        $("#agregar").click(function(){
            $("#id_grupo").val("");
            $("#id_nivelmalla").val("");
            $("#id_horas2").val("");
            $("#id_sinarticuladagrupo").attr('checked',true);
            $("#participantes_panel").modal({width: '800px', backdrop: 'static'});
            $("#participantes_panel").modal("show");

        });
        buscar_participantes_indivudual = function(query, process) {
            $.get("/reportes", {'action':'data', 'model': 'Inscripcion',
                'p': 1, 'q': query, 's': 10}, function(data) {
                if (data.results) {
                    $("#id_inscripcion").get(0).results = data.results;
                    listing = [];
                    for (var i in data.results) {
                        var dato = data.results[i];
                        listing.push(dato.name);
                    }
                    process(listing);
                }
            }, 'json');
        };


        $('#id_inscripcion').typeahead({source: buscar_participantes_indivudual, updater: function(item) {
            var results = $("#id_inscripcion").get(0).results;
            for (var i in results) {
                var datos = results[i];
                if (item==datos.name) {
                    $("#id_inscripcion").attr("myval",datos.id);
                    ins=datos.id;
                    $("#id_inscripcion").val(ins);
                }
            }
            return item;
        }});

        $("#participantes_panel_indivudual .btn-cerrar").click(function() {
            $("#id_horas").val("");
            $("#id_nivelmallaind").val("");
            $("#id_sinarticulada").attr('checked',false);
            $($("#id_horas").get(0).parentNode).find(".help-text").html("");
            $("#participantes_panel_indivudual .btn-buscar").show();
            $("#participantes_panel_indivudual").modal("hide");
            return false;
        });

        $("#participantes_panel_indivudual .btn-buscar").click(function() {
            var horas = $("#id_horas").val();
            var idnivel =$("#id_nivelmallaind").val();
            var v = $("#id_horas").val();
            var p = solo_numeros(v);
            if (p != v.length)
            {
              $($("#id_horas").get(0).parentNode).find(".help-text").html("Ingresar solo Numeros");
              $("#id_horas").val("");
              $("#id_horas").focus();
              $("#participantes_panel_indivudual .btn-buscar").show();
            }




                    if (idnivel!=''){
                            if (parseInt(ins)>0){

                                if (parseInt(horas)>0){

                                        $("#participantes_panel_indivudual").modal("hide");
                                        smoke.confirm('Esta seguro que desea Agregar este Estudiante', function(e){
                                                if (e){

                                                    if (document.getElementById('id_sinarticulada').checked){
                                                      location.href = "/vinculacion?action=agregar&id="+ins+"&vinculacion="+'{{ vinculacion.id }}'+"&horas="+horas+"&idnivel="+idnivel;
                                                    }else{
                                                      location.href = "/vinculacion?action=agregarsinarticulada&id="+ins+"&vinculacion="+'{{ vinculacion.id }}'+"&horas="+horas+"&idnivel="+idnivel;
                                                    }

                                                }else{

                                                    $("#participantes_panel").modal("show");
                                                    $("#id_inscripcion").val("");
                                                }
                                                }, {
                                                ok: "CONTINUAR",
                                                cancel: 'CANCELAR',
                                                classname: "custom-class",
                                                reverseButtons: true
                                        });

                                }else{
                                    $("#participantes_panel_indivudual").modal("hide");
                                    smoke.alert("La hora debe ser mayor a Cero");
                                }


                            }else{
                                $("#participantes_panel_indivudual").modal("hide");
                                 smoke.alert("Debe seleccionar la inscripción");
                            }
                    }else{
                        $("#participantes_panel_indivudual").modal("hide");
                        smoke.alert("Debe seleccionar el nivel");

                    }




        });


        $("#agregari").click(function(){
            $("#id_inscripcion").val("");
            $("#id_nivelmallaind").val("");
            $("#id_horas").val("");
            $("#id_sinarticulada").attr('checked',true);
            $("#participantes_panel_indivudual").modal({width: '800px', backdrop: 'static'});
            $("#participantes_panel_indivudual").modal("show");

        });

        $(".btn-aprobar").click(function() {
              idinscrip = $(this).attr('idinscripcion');
              $("#id_revisionestudiante").attr("checked",false);
              $("#id_revisionproyecto").attr("checked",false);
              $("#id_revisiondocente").attr("checked",false);
              $("#aprobacionvinculacion_panel #id_comentarios").val("");
              $("#aprobacionvinculacion_panel #id_comentarios").css("width", '90%');
              $("#aprobacionvinculacion_panel").modal({backdrop: 'static' , width:'45%'});
              $("#aprobacionvinculacion_panel .paneltitle").html('Ingresar Aprobación');
              $("#aprobacionvinculacion_panel").modal("show");
              $("#aprobacionvinculacion_panel #id_comentarios").attr("readonly",false);
              return false;
        });

        $("#id_revisionestudiante").change(function(){
                if ($("#id_revisionestudiante").is(':checked')){
                    $("#id_revisionestudiante").attr('checked',true);
                }
                else{
                    $("#id_revisionestudiante").attr('checked',false);
                }
          });

          $("#id_revisionproyecto").change(function(){
                if ($("#id_revisionproyecto").is(':checked')){
                    $("#id_revisionproyecto").attr('checked',true);
                }
                else{
                    $("#id_revisionproyecto").attr('checked',false);
                }
          });

          $("#id_revisiondocente").change(function(){
                if ($("#id_revisiondocente").is(':checked')){
                    $("#id_revisiondocente").attr('checked',true);
                }
                else{
                    $("#id_revisiondocente").attr('checked',false);
                }
          });

          $("#id_comentarios").blur(function(){
            $($(this).get(0).parentNode).find(".help-text").html("");
            $("#aprobacionvinculacion_panel .btn-success").show();
          });

          $("#aprobacionvinculacion_panel .btn-success").click(function() {
              var revisionestud = false;
              var revisionproyecto = false;
              var revisiondocente = false;
              var act_vinc = {{ vinculacion.id }}

              if ($("#id_revisionestudiante").is(':checked')){
                  revisionestud = true;
                  }
              if ($("#id_revisionproyecto").is(':checked')){
                  revisionproyecto = true;
                  }
              if ($("#id_revisiondocente").is(':checked')){
                  revisiondocente = true;
                  }

              if ($("#id_comentarios").val() != ""){
                    $.post("/vinculacion",{"action":"aprobarvinculacion","id" : act_vinc,"revisionestud" : revisionestud, "revisionproyecto": revisionproyecto ,"revisiondocente": revisiondocente,"comentarios": $("#id_comentarios").val()},function(data) {
                        if (data.result=="ok"){
                            $("#aprobacionvinculacion_panel" ).modal('hide');
                                smoke.alert('Se aprobó la vinculación a '+data.estud+' estudiantes '+data.sin_aprob+' sin aprobacion');
                                location.reload();
                        }
                        if (data.result=="ok2"){
                            $("#aprobacionvinculacion_panel" ).modal('hide');
                                smoke.alert('Se grabó correctamente aprobación a '+data.estud+' estudiantes');
                                location.reload();
                        }
                        if (data.result=="bad"){
                            $("#aprobacionvinculacion_panel" ).modal('hide');
                            smoke.alert('Error intentelo nuevamente');
                        }
                    },"json");
              }
              else{
              }
                return false;
          });

        $("#aprobacionvinculacion_panel .btn-cerrar").click(function() {
            $("#aprobacionvinculacion_panel").modal('hide');
        });

        buscar_participantesmod = function(query, process) {
            $.get("/reportes", {'action':'data', 'model': 'Nivel',
                'p': 1, 'q': query, 's': 10}, function(data) {
                if (data.results) {
                    $("#id_grupomod").get(0).results = data.results;
                    listing = [];
                    for (var i in data.results) {
                        var dato = data.results[i];
                        listing.push(dato.name);
                    }
                    process(listing);
                }
            }, 'json');
        };

        $('#modificagrupo_panel #id_grupomod').typeahead({source: buscar_participantesmod, updater: function(item) {
            var results = $("#id_grupomod").get(0).results;
            for (var i in results) {
                var datos = results[i];
                if (item==datos.name) {

                    $("#id_grupomod").attr("myval",datos.id);
                    m=datos.id;
                    $("#id_grupomod").val(m);
                }
            }
            return item;
        }});


        $("#modificagrupo_panel .btn-buscar").click(function() {


            var horasmod = $("#id_horasmod").val();
            var idnivel =$("#id_nivelmallamod").val();

            var v = $("#id_horasmod").val();
            var p = solo_numeros(v);
            if (p != v.length)
            {
              $($("#id_horasmod").get(0).parentNode).find(".help-text").html("Ingresar solo Numeros");
              $("#id_horasmod").val("");
              $("#id_horasmod").focus();
              $("#modificagrupo_panel .btn-buscar").show();
            }



            if (parseInt(idnivel)>0){

                if (v>0){

                   // if(parseInt(m)>0){

                            $("#modificagrupo_panel").modal("hide");
                            smoke.confirm('Esta seguro que desea Modificar las Horas de este Grupo', function(e){
                                if (e){
                                    location.href = "/vinculacion?action=modificarhoras&id="+m+"&vinculacion="+'{{ vinculacion.id }}'+"&horasmod="+horasmod+"&idnivel="+idnivel;
                                }else{

                                    $("#modificagrupo_panel").modal("show");
                                    $("#id_grupomod").val("");
                                }
                                }, {
                                ok: "CONTINUAR",
                                cancel: 'CANCELAR',
                                classname: "custom-class",
                                reverseButtons: true
                            });
                    //}else{
                      //  $("#modificagrupo_panel").modal("hide");
                       // smoke.alert("Debe Seleccionar grupo");
                    //}

                }else{

                      $("#modificagrupo_panel").modal("hide");
                      smoke.alert("La hora debe ser mayor a Cero");
                }
            }else{
                $("#modificagrupo_panel").modal("hide");
                smoke.alert("Debe seleccionar el nivel");
            }


        });

        $(".btn-modificar").click(function() {
            $("#id_grupomod").val("");
            $("#id_horasmod").val("");
            $("#modificagrupo_panel").modal({width: '800px', backdrop: 'static'});
            $("#modificagrupo_panel").modal("show");
        });

        $("#modificagrupo_panel .btn-cerrar").click(function() {
            $("#modificagrupo_panel").modal('hide');
        });


        $("#actualizarnivel").click(function() {
            $("#id_nivelactualiza").val("");
            $("#actualiza_nivelgrupo").modal({width: '800px', backdrop: 'static'});
            $("#actualiza_nivelgrupo").modal("show");
        });

        $("#actualiza_nivelgrupo .btn-cerrar").click(function() {
            $("#actualiza_nivelgrupo").modal('hide');
        });


         $("#actualiza_nivelgrupo .btn-success").click(function(){
               if ($("#id_nivelactualiza").val()>0){
                 var nivelactualiza= $("#id_nivelactualiza").val();
                 $("#actualiza_nivelgrupo").modal('hide');
                 smoke.confirm('Se Asignara Nivel', function(e){
                    if (e){
                        location.href = '/vinculacion?action=cambiarnivel&id='+nivelactualiza+'&idvinculacion='+{{ vinculacion.id }};
                    }else{
                    }
                    }, {
                    ok: "CONTINUAR",
                    cancel: "CANCELAR",
                    classname: "custom-class",
                    reverseButtons: true
                });
               }else{
                  smoke.alert("Debe selecciona el grupo");
               }
         });

         actulizarnivelindividual=function(iddiv) {
              idregistroestu=iddiv;
            $("#id_nivelactualizaindividual").val("");

            $("#actualiza_nivelgrupoindividual").modal({width: '800px', backdrop: 'static'});
            $("#actualiza_nivelgrupoindividual").modal("show");
        };


         $("#actualiza_nivelgrupoindividual .btn-cerrar").click(function() {
            $("#actualiza_nivelgrupoindividual").modal('hide');
        });

        $("#actualiza_nivelgrupoindividual .btn-success").click(function(){
               if ($("#id_nivelactualizaindividual").val()>0){
                 var nivelactualizaindi= $("#id_nivelactualizaindividual").val();
                 $("#actualiza_nivelgrupoindividual").modal('hide');
                 smoke.confirm('Se Asignara Nivel', function(e){
                    if (e){
                        location.href = '/vinculacion?action=cambiarnivelindividual&id='+nivelactualizaindi+'&idregistro='+idregistroestu+'&idvinculacion='+{{ vinculacion.id }};
                    }else{
                    }
                    }, {
                    ok: "CONTINUAR",
                    cancel: "CANCELAR",
                    classname: "custom-class",
                    reverseButtons: true
                });
               }else{
                  smoke.alert("Debe selecciona el grupo");
               }
         });



        });
    </script>
{% endblock %}
{% block canvas %}
     <div class='row-fluid'>
     <div class='span12'>
        <div class='span1'>


        </div>
        <div class='span2' style="text-align: right">
            {% if not vinculacion.finalizado %}
                {% if perms.sga.add_aprobacionvinculacion %}
                    <a href="#" class="btn btn-aprobar btn-warning" > <i class="icon-check"></i> Aprobar Vinculacion por Grupo</a>
                {% endif %}
            {% endif %}
        </div>
        <div class='span2' style="text-align: right">
            {% if not vinculacion.finalizado %}
                {% if perms.sga.change_inscripcionpracticas %}
                    {% if perms.sga.add_aprobacionvinculacion %}
                        <a href="#" class="btn btn-modificar " id=modificar> <i class="icon-list"></i> Modificar Horas por Grupo</a>
                    {% endif %}
                {% endif %}
            {% endif %}
        </div>
        {% if not persona.pertenece_soporte %}
            <div class='span2' style="text-align: right">
                {% if perms.sga.add_aprobacionvinculacion %}
                    {% if not vinculacion.finalizado %}
                        <a href="#" class='btn btn-info' id=agregar><i class="icon-search"></i> Agregar Grupo</a>
                    {% endif %}
                {% endif %}
            </div>
            <div class='span2' style="text-align: right">
                {% if perms.sga.add_aprobacionvinculacion %}
                    <a href="#" class='btn btn-warning' id=actualizarnivel><i class="icon-barcode"></i> Actualizar Nivel</a>
                {% endif %}
            </div>

             <div class='span2' style="text-align: left">
                 {% if not vinculacion.finalizado %}
                     {% if perms.sga.add_aprobacionvinculacion or perms.sga.change_aprobacionvinculacion  %}
                        <a href="#" class='btn btn-success' id=agregari><i class="icon-search" style="text-align: left"></i>  Agregar Individual</a>
                     {% endif %}
                 {% endif %}
            </div>
        {% endif %}
        <div class='span1'>
            <a href="/vinculacion" class='btn'><i class="icon-arrow-left"></i> Atr&aacute;s</a>
        </div>

    </div>
     <div class='row-fluid'>
         <div class='span12'>
             <h3>Estudiantes</h3>
         </div>
     </div>

    <div class='row-fluid'>

        <div class='span12'>
            <form class="form-search">
                <input class='searchinput input-medium search-query' type='text' id='searchfield' value='{{ search }}'/>
                <a href="#" id='search' class='btn btn-success'><i class="icon-search icon-white"></i> Buscar</a>
                {% if search %}
                    <a href="/vinculacion?action=participantes&id={{ vinculacion.id }}" id='allresults' class='btn btn-warning'><i class="icon-refresh icon-white"></i> Todos</a>
                {% endif %}
            </form>
        </div>
    </div>
    </div>
    <div class='row-fluid'>
        <div class='span12'>
        <table class='table table-bordered table-striped' cellpadding="0" cellspacing="0">
            <thead>
            <tr>
                <th >Nombres</th>
                <th >Horas</th>
                <th >Nivel </th>
                <th >Grupo</th>
                <th >Nota </th>
                <th >Fecha</th>
{#                <th></th>#}
            </tr>
            </thead>
            <tbody>
            {% for p in participantes %}
                    <tr>
                        <td>{{ p.inscripcion.persona.nombre_completo_inverso }}

                            <br/>
                            {% if  p.inscripcion.graduado %}
                                <span class="label label-warning">{% if p.inscripcion.persona.sexo_id == 1 %}GRADUADA{% else %}GRADUADO{% endif %} </span>
                            {% endif %}
                            {% if p.inscripcion.alumno_estado %}
                                <span class="label label-info">{% if p.inscripcion.persona.sexo_id == 1 %}EGRESADA{% else %}EGRESADO{% endif %} </span>
                            {% endif %}
                        </td>

                        <td>{{ p.horas }}</td>
                        <td>
                             {% if not p.nivelmalla  %}
                                 {% if persona.pertenece_vinculacion %}
                                   <a class="btn btn-success" onclick="actulizarnivelindividual({{ p.id }})" iidiv={{ p.id }}>Agregar Nivel</a>
                                 {% endif %}
                           {% else %}
                                 {{ p.nivelmalla.nombre }}
                           {% endif %}

                        </td>
                        <td>{{ p.inscripcion.grupo.nombre }}</td>
                            {% for r in record %}
                                 {% if p.inscripcion == r.inscripcion  %}
                                      <td>
                                        {{ r.nota }}
                                      </td>
                                      <td>
                                        {{ r.fecha|date:'d-m-Y' }}
                                      </td>
                                 {% endif %}
                            {% endfor %}

                        <td>

{#                            OCU 25-07-2018 accion para que la vinculacion se pueda eliminar solo si no esta egresado o graduado  #}
{#                            OCU 25-04-2019 se agrego otra condicion para que no pueda eliminar actividad si ademas de las otras condiciones #}
{#                            tiene aprobada la vinculacionaccion#}
{#                            if not m.inscripcion.tiene_malla_nueva():    #}
                            {# OCU 23-dic-2019 para la malla nueva verificar que no tenga aprobada la actividad                         #}
{#                            {% if not p.inscripcion.alumno_estado and not p.inscripcion.graduado and p.inscripcion.malla_inscripcion.malla.nueva_malla and not p.inscripcion.tiene_aprobadavinculacion %}#}
                            
                            {% if not persona.pertenece_soporte %}
                                {% if perms.sga.add_aprobacionvinculacion %}
                                    {% if not p.inscripcion.alumno_estado and not p.inscripcion.graduado and p.inscripcion.malla_inscripcion.malla.nueva_malla  and not p.inscripcion|args:p|call:"tiene_aprobadavinculacion" %}
                                        <a class="btn btn-danger" iid={{ p.id }}>Eliminar</a>
                                    {% else %}
                                    {#OCU 25-04-2019 se agrego otra condicion para que no pueda eliminar actividad si ademas de las otras condiciones #}
                                    {#tiene aprobada la vinculacionaccion#}
        {#                               <span title="Elimina solo actividad"> <a class="btn btn-info eliminaact" idact={{ p.id }}> Eliminar </a> </span>#}
                                            {# OCU 23-dic-2019 para la malla antigua verificar que no tenga la asignatura de Vinculacion aprobada          #}
                                            {% if not p.inscripcion.alumno_estado and not p.inscripcion.graduado and not p.inscripcion.existe_vinculacion and not p.inscripcion|args:p|call:"tiene_aprobadavinculacion"  %}
                                                <a class="btn btn-danger" iid={{ p.id }}>Eliminar</a>
                                            {% endif %}
                                    {% endif %}
                                {% endif %}
                            {% endif %}

                        </td>
                        <td></td>

                    </tr>
            {% endfor %}
            {% if not participantes %}
                <tr>
                    <td colspan="4">
                        NO HAY PARTICIPANTES
                    </td>
                </tr>
            {% endif %}
            </tbody>
        </table>
        </div>
    </div>
    <div class='row-fluid'>
        <div class="span12">
            <div class='pagination'>
                <ul>
                    {% for pagenumber in paging.page_range %}
                        <li {% if pagenumber == page.number %}class='active'{% endif %}><a href="/retirados?page={{ pagenumber }}">{{ pagenumber }}</a></li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="participantes_panel" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Buscar Participantes</h3>
        </div>
        <div class="modal-body" style="text-align: left">
            <form id="formulario5"  action="" method="POST">
            {% for field in form %}
                <fieldset class="control-group nomargins">
                <label style="text-align: left;width: 10%;font-size: 16px"  for="id_{{ field.name }}"><b>{{ field.label }}:</b></label>
                    <div class="controls" style="width: 98%">
                        {{ field }}
                        <p class="help-text">{{ field.help_text }} </p>
                    </div>
                </fieldset>
            {% endfor %}
            </form>

        </div>
        <div class="modal-footer">
            <a href="#" class="btn btn-buscar btn-success">Agregar</a>
            <a href="#" class="btn btn-cerrar btn-warning">Salir</a>
        </div>
    </div>

    <div class="modal fade static" id="participantes_panel_indivudual" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Buscar Participante</h3>
        </div>
        <div class="modal-body" style="text-align: left">
            <form id="formulario5"  action="" method="POST">
            {% for field in form2 %}
                <fieldset class="control-group nomargins">
                <label style="text-align: left;width: 10%;font-size: 16px"  for="id_{{ field.name }}"><b>{{ field.label }}:</b></label>
                    <div class="controls" style="width: 98%">
                        {{ field }}
                        <p class="help-text">{{ field.help_text }} </p>
                    </div>
                </fieldset>
            {% endfor %}
            </form>

        </div>
        <div class="modal-footer">
            <a href="#" class="btn btn-buscar btn-success">Agregar</a>
            <a href="#" class="btn btn-cerrar btn-warning">Salir</a>
        </div>
    </div>

    <div class='row-fluid'>
        <div class="span12">
            <div class="modal fade static" id="aprobacionvinculacion_panel" style="display: none;">
                <div class="modal-header alert-info" style="text-align: center">
                     <h3 class='paneltitle1'></h3>
                     <h3>Esta verificación permite que la nota de la materia Vinculación de los estudiantes
                         de este grupo pase al Histórico. Sírvase confirmar lo siguiente:  </h3>
                </div>
                <div class="modal-body panelbody" >
                    <form id="formulario3" class='form-horizontal' action="" method="POST">
                        {% for field in aprobargrupo %}
                           <fieldset class="control-group nomargins">
                                    <label class="control-label" for="id_{{ field.name }}">{{ field.label }}</label>
                                    <div class="controls">
                                        {{ field }}
                                        <p class="help-text">{{ field.help_text }} </p>
                                    </div>
                                </fieldset>
                        {% endfor %}
                    </form>
                </div>
                <div class="modal-footer">
                    <div >
                        <a href="#" class="btn btn-success btn-success"> <b> GUARDAR</b></a>
                        <a href="#" class="btn btn-cerrar btn-warning">SALIR</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade static" id="modificagrupo_panel" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Buscar Grupo</h3>
        </div>
        <div class="modal-body" style="text-align: left">
            <form id="formulario5"  action="" method="POST">
            {% for field in formod %}
                <fieldset class="control-group nomargins">
                <label style="text-align: left;width: 10%;font-size: 16px"  for="id_{{ field.name }}"><b>{{ field.label }}:</b></label>
                    <div class="controls" style="width: 98%">
                        {{ field }}
                        <p class="help-text">{{ field.help_text }} </p>
                    </div>
                </fieldset>
            {% endfor %}
            </form>

        </div>
        <div class="modal-footer">
            <a href="#" class="btn btn-buscar btn-success">Agregar</a>
            <a href="#" class="btn btn-cerrar btn-warning">Salir</a>
        </div>
    </div>

     <div class="modal fade static" id="actualiza_nivelgrupo" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Seleccionar Grupo</h3>
        </div>
        <div class="modal-body" style="text-align: left">
            <form id="formulario5actualiza_Dato"  action="" method="POST">
            {% for field in formCambioNivel %}
                <fieldset class="control-group nomargins">
                <label style="text-align: left;width: 10%;font-size: 16px"  for="id_{{ field.name }}"><b>{{ field.label }}:</b></label>
                    <div class="controls" style="width: 98%">
                        {{ field }}
                        <p class="help-text">{{ field.help_text }} </p>
                    </div>
                </fieldset>
            {% endfor %}
            </form>

        </div>
        <div class="modal-footer">
            <a href="#" class="btn btn-buscar btn-success">Agregar</a>
            <a href="#" class="btn btn-cerrar btn-warning">Salir</a>
        </div>
    </div>

    <div class="modal fade static" id="actualiza_nivelgrupoindividual" style="display: none;">
        <div class="modal-header">
            <h3 class="paneltitle">Seleccionar Grupo</h3>
        </div>
        <div class="modal-body" style="text-align: left">
            <form id="formulario5actualiza_Dato"  action="" method="POST">
            {% for field in formCambioNivelIndividual %}
                <fieldset class="control-group nomargins">
                <label style="text-align: left;width: 10%;font-size: 16px"  for="id_{{ field.name }}"><b>{{ field.label }}:</b></label>
                    <div class="controls" style="width: 98%">
                        {{ field }}
                        <p class="help-text">{{ field.help_text }} </p>
                    </div>
                </fieldset>
            {% endfor %}
            </form>

        </div>
        <div class="modal-footer">
            <a href="#" class="btn btn-buscar btn-success">Agregar</a>
            <a href="#" class="btn btn-cerrar btn-warning">Salir</a>
        </div>
    </div>


{% endblock  %}
