{% extends "basebs.html" %}
{% load sga_extras %}
{% block heading %}
    <script type="text/javascript">

    $(function(){

        $("#search").click(function() {
            var term = $("#searchfield").val().toUpperCase();
            location.href = "/solicitud_materiaonline?s="+term;
        });
        $('#searchfield').keyup(function(e) {
            if(e.keyCode == 13) {
                $("#search").trigger("click");
            }
         });

        buscar_inscripcion = function(query, process) {
            $.get("/reportes", {'action':'databiblio', 'model': 'Inscripcion:carrera__id__in={{ coordid }}', 'p': 1, 'q': query, 's': 10}, function(data) {
                if (data.results.length > 0) {
                    $("#estudiante").get(0).results = data.results;
                    listing = [];
                    for (var i in data.results) {

                        var dato = data.results[i];
                        listing.push(dato.alias);
                    }
                    process(listing);
                }else{
                    $("#estudiante").get(0).results = "";
                    $("#estudiante").attr("myval",0);
                    listing = [];
                    process(listing);
                }
            }, 'json');
        };

        var est=0;
        $('#estudiante').typeahead({source: buscar_inscripcion, updater: function(item) {
            var results = $("#estudiante").get(0).results;
            for (var i in results) {
                var datos = results[i];
                if (item==datos.alias) {
                    $("#estudiante").attr("myval",datos.id);
                }
            }
            return item;
        }});

        $("#buscaasignatura").click(function(){
            var estudiante = $("#estudiante").attr("myval");

            $.post("/solicitud_materiaonline", { "action": "consultaasignatura", estudiante:estudiante}, function (data) {
               if (data.result == 'ok') {
                   var html='<option value=0>-------</option>';
                   for (var p in data.asignaturas) {
                       html = html + '<option value=' + data.asignaturas[p].id + '>' + data.asignaturas[p].asignatura + ' </option>'
                   }
                   $($("#estudiante").get(0).parentNode).find(".help-textestudiante").html("");
                   $($("#cmbasignatura").get(0).parentNode.parentNode).show();
                   $("#cmbasignatura").html(html);
               }
            }, "json");
        });

        $("#id_observacion, #id_grupo").addClass('input-xxlarge');
        $("#agregarsolicitudmateria").click(function(){

            $("#modalsolicitudmateria").modal({"backdrop":"static", keyboard: 'false', width: "600px"});
            $("#modalsolicitudmateria").modal("show");
        });
        $("#modalsolicitudmateria .btn-cerrar").click(function(){
            $("#modalsolicitudmateria").modal("hide");
        });

{#        validaCampos = function(campo){#}
{#            let variable = $("#"+campo).val();#}
{#            if (variable==""){#}
{#                $(".help-text"+campo).html("Debe seleccionar un "+ campo);#}
{#            }#}
{#            else{#}
{#                $($("#"+campo).get(0).parentNode).find(".help-text"+campo).html("");#}
{#            }#}
{#        }#}


        function ValidarDatos(){
            if ($("#cmbasignatura").val() == 0) {
                $(".help-textasignatura").html("Debe seleccionar una asignatura");
                return 1;
            }
            if ($("#estudiante").val() == 0) {
                 $(".help-textestudiante").html("Debe seleccionar un estudiante");
                 return 1;
            }
            if ($("#grupo").val()==""){
                $(".help-textgrupo").html("Completar la informacion de grupo");
                return 1;
            }
            if($("#observacion").val()==""){
                $(".help-textobservacion").html("Completar la informacion de observacion");
                return 1;
            }
            if ($("#subirevidencia").val() == "") {
                $(".helpsubirevidencia").html("Debe seleccionar un archivo");
                return 1;
            }

            return 0;
        }

        function Limpiaracampos(){
             $($("#cmbasignatura").get(0).parentNode).find(".help-textasignatura").html("");
            $($("#estudiante").get(0).parentNode).find(".help-textestudiante").html("");
            $($("#grupo").get(0).parentNode).find(".help-textgrupo").html("");
            $($("#observacion").get(0).parentNode).find(".help-textobservacion").html("");
            $($("#subirevidencia").get(0).parentNode).find(".helpsubirevidencia").html("");
        }

        $("#modalsolicitudmateria .btn-guardar").click(function(){
            Limpiaracampos();
            if(ValidarDatos()==0){
                var inputFileImage = document.getElementById("subirevidencia");
                var file = inputFileImage.files[0];

                var formData = new FormData();
                formData.append("action", "addsolicitud");
                formData.append("asignatura", $("#cmbasignatura").val());
                formData.append("estudiante", $("#estudiante").attr("myval"));
                formData.append("grupo", $("#grupo").val());
                formData.append("observacion", $("#observacion").val());
                formData.append("evidencia", file);

                Swal.fire({
                    title: "Alerta!",
                    text: "¿Está seguro de guardar la solicitud?",
                    icon: "question",
                    showCancelButton: true,
                    confirmButtonColor: "#0d437d",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Guardar",
                    cancelButtonText: "Cancelar"
                }).then(function(result){
                    if (result.isConfirmed) {
                        $("#modalsolicitudmateria").modal("hide");
                        $.ajax({
                            url: "/solicitud_materiaonline",
                            type: "POST",
                            data: formData,
                            processData: false,
                            contentType: false,
                            success: function(data) {
                                if (data.result == 'ok') {
                                    Swal.fire('Notificación !', 'Solicitud guardada correctamente', 'success').then(function(){
                                       location.reload()
                                    });
                                } else {
                                    Swal.fire('Notificación !', 'Error', 'warning');
                                }
                            },
                            error: function() {
                                Swal.fire('Notificación !', 'Error al procesar la solicitud', 'error');
                            }
                        });
                    }
                });
            }
        });

        var numeros1="0123456789.";
        function solo_numeros(texto){
           var num = 0;
           for(i=0; i<texto.length; i++){
              if (numeros1.indexOf(texto.charAt(i),0)!=-1){
                  num = num +1;
              }
           }
           return num;
        }

        validarNotas = function(variabNota, notaMaxima){
            let nota = $("#"+variabNota).val();
            var p = solo_numeros(nota);
            if (parseInt(nota) > parseInt(notaMaxima)) {
                 $("#"+variabNota).val(nota);
                 Swal.fire("Notificación!", "No puede tener un valor mayor de <strong style='color:green'>"+notaMaxima+"</strong>", "error");
                 $("#"+variabNota).val("");
            }

            if (p != nota.length){
                $($("#"+variabNota).get(0).parentNode).find(".help-text").html("<span style='color:red'>Ingrese solo numeros</span>");
                $("#"+variabNota).val("");
                $("#"+variabNota).focus();
            }else{
                 $($("#"+variabNota).get(0).parentNode).find(".help-text").html("");
            }
        };

        {# ABRIR MODAL NOTAS#}
        $("#agregarnotas").click(function(){
             $("#nota1").val('');
            $("#nota2").val('');
            $("#nota3").val('');
            $("#nota4").val('');
            $("#examen").val('');
            $("#asistencia").val('');
            $("#modalnotas #paneltitle1").html('Ingrese Notas del Estudiante');
            $("#modalnotas").modal({"backdrop":"static", keyboard: 'false', width: "400px", height:"300px"});
            $("#modalnotas").modal("show");
        });

        $("#modalnotas .btn-cerrar").click(function(){
            $("#modalnotas").modal("hide");
        });

        function validaNotasVacias(){
            if($("#nota1").val()==""){
                $($("#nota1").get(0).parentNode).find(".help-text").html("<span style='color:red'>Ingresar una nota</span>");
                return 1;
            }
            if($("#nota2").val()==""){
                $($("#nota2").get(0).parentNode).find(".help-text").html("<span style='color:red'>Ingresar una nota</span>");
                return 1;
            }
            if($("#nota3").val()==""){
                $($("#nota3").get(0).parentNode).find(".help-text").html("<span style='color:red'>Ingresar una nota</span>");
                return 1;
            }
            if($("#nota4").val()==""){
                $($("#nota4").get(0).parentNode).find(".help-text").html("<span style='color:red'>Ingresar una nota</span>");
                return 1;
            }
            if($("#examen").val()==""){
                $($("#examen").get(0).parentNode).find(".help-text").html("<span style='color:red'>Ingresar una nota de examen</span>");
                return 1;
            }
            if($("#asistencia").val()==""){
                $($("#asistencia").get(0).parentNode).find(".help-text").html("<span style='color:red'>Ingresar la asistencia</span>");
                return 1;
            }
            return 0;
        }

        $("#modalnotas .btn-guardar").click(function(){
            if(validaNotasVacias()==0){
                var formData = new FormData();
                formData.append("action", "addnotas");
                formData.append("nota1", parseFloat($("#nota1").val()));
                formData.append("nota2", parseFloat($("#nota2").val()));
                formData.append("nota3", parseFloat($("#nota3").val()));
                formData.append("nota4", parseFloat($("#nota4").val()));
                formData.append("examen", parseFloat($("#examen").val()));
                formData.append("asistencia", parseFloat($("#asistencia").val()));
                formData.append("ids", $("#agregarnotas").attr('ids'));
                formData.append("idinscr", $("#agregarnotas").attr('idinscri'));
                formData.append("asig", $("#agregarnotas").attr('asig'));

                Swal.fire({
                    title: "Alerta!",
                    text: "¿Está seguro de ingresar las notas?",
                    icon: "question",
                    showCancelButton: true,
                    confirmButtonColor: "#0d437d",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Guardar",
                    cancelButtonText: "Cancelar"
                }).then(function(result){
                    if (result.isConfirmed) {
                        $.ajax({
                            url: "/solicitud_materiaonline",
                            type: "POST",
                            data: formData,
                            processData: false,
                            contentType: false,
                            success: function(data) {
                                if (data.result == 'ok') {
                                    Swal.fire('Notificación !', 'Notas ingresadas correctamente', 'success').then(function(){
                                        $("#modalnotas").modal("hide");
                                        location.reload()
                                    });
                                } else {
                                    Swal.fire('Notificación !', 'Error', 'warning');
                                }
                            },
                            error: function() {
                                Swal.fire('Notificación !', 'Errora al ingresar de notas', 'error');
                            }
                        });
                    }
                });
            }
        });

        function aprobacionsolicitud(ids, tipo){
            Swal.fire({
                title: 'Alerta!',
                text: "Ingrese una observacion",
                type: 'warning',
                input: 'text',
                inputAttributes: {
                    autocapitalize: 'off'
                },
                showCancelButton: true,
                confirmButtonText: 'Guardar!',
                cancelButtonText: 'Cancelar',
                inputValidator: function (value) {
                    if (!value) {
                        return "Ingrese una observacion";
                    }
                }
            }).then(function (result) {
                if (result.isConfirmed) {
                     $.post("/solicitud_materiaonline", {'action':'aprobacionSolicitud','ids':ids, observacion:result.value, tipo:tipo }, function(data) {
                        if (data.result=="ok") {
                            if(tipo==1){
                                Swal.fire('Notificacion!','Se aprobo correctamente','success').then(function(){
                                    location.reload()
                                });
                            }else{
                                Swal.fire('Notificacion!','La solicitud fue reprobada','success').then(function(){
                                    location.reload()
                                });
                            }
                        } else {
                            Swal.fire('Notificacion!','Error al aprobar','error');
                        }
                    }, "json");
                }
            });
        }
        {# APROBAR SOLICITUD #}
        $("#aprobarsolicitud").click(function(){
            var ids= $(this).attr("ids");
            Swal.fire({
                title: "Alerta!",
                text: "¿Esta seguro que desea aprobar la solicitud?",
                icon: "question",
                showDenyButton: true,
                showCancelButton: true,
                confirmButtonColor: "#0d437d",
                cancelButtonColor: "#d33",
                confirmButtonText: "Aprobar",
                cancelButtonText: 'Cancelar',
                denyButtonText: "Reprobar"
            }).then(function(result) {
                if (result.isConfirmed) {
                    aprobacionsolicitud(ids,1);
                }else if (result.isDenied) {
                    aprobacionsolicitud(ids,2);
                }

            });
        });

        {# ENVIAR SOLICITUD #}
        $("#enviarsolicitud").click(function(){
            var ids= $(this).attr("ids");
            var inscripcion = $(this).attr("inscripcion");

            Swal.fire({
                title: "Alerta!",
                text: "¿Esta seguro que desea enviar a secretaria?",
                icon: "question",
                showCancelButton: true,
                confirmButtonColor: "#0d437d",
                cancelButtonColor: "#d33",
                confirmButtonText: "Guardar",
                cancelButtonText: "Cancelar"
            }).then(function(result){
                if (result.isConfirmed) {
{#                    showWaiting("Solicitud Materia Online","Espere unos segundos por favor...");#}
                    $.post("/solicitud_materiaonline", {'action':'enviar','ids':ids}, function(data) {
                        if (data.result=="ok") {
                            Swal.fire('Notificacion!','Se envio la solicitud correctamente','success').then(function(){
                                location.reload()
                            });

                        } else {
                            Swal.fire('Notificacion!','Error al enviar la solicitud','error');
                        }
{#                       hideWaiting();#}
                    }, "json");
                }
            });
        });

        {# MODAL EDITAR NOTAS#}
        $("#editarNotas").click(function(){
            $("#nota1e").val($(this).attr('nota1'));
            $("#nota2e").val($(this).attr('nota2'));
            $("#nota3e").val($(this).attr('nota3'));
            $("#nota4e").val($(this).attr('nota4'));
            $("#examene").val($(this).attr('examen'));
            $("#modalnotasedit #idsolicitud").val($(this).attr('ids'));
            $("#modalnotasedit #paneltitle1").html('Modificar Notas');
            $("#modalnotasedit").modal({"backdrop":"static",keyboard: 'false', width: "400px", height:"260px"});
            $("#modalnotasedit").modal("show");
        });

        $("#modalnotasedit .btn-cerrar").click(function(){
            $("#modalnotasedit").modal("hide");
        });

        $("#modalnotasedit .btn-guardar").click(function(){
            var valida = true;

            if($("#nota1e").val()==""){
                $($("#nota1e").get(0).parentNode).find(".help-text").html("<span style='color:red'>Ingresar una nota</span>");
                valida = false;
            }
            if($("#nota2e").val()==""){
                $($("#nota2e").get(0).parentNode).find(".help-text").html("<span style='color:red'>Ingresar una nota</span>");
                valida=false;
            }
            if($("#nota3e").val()==""){
                $($("#nota3e").get(0).parentNode).find(".help-text").html("<span style='color:red'>Ingresar una nota</span>");
                valida=false;
            }
            if($("#nota4e").val()==""){
                $($("#nota4e").get(0).parentNode).find(".help-text").html("<span style='color:red'>Ingresar una nota</span>");
                valida=false;
            }
            if($("#examene").val()==""){
                $($("#examene").get(0).parentNode).find(".help-text").html("<span style='color:red'>Ingresar una nota de examen</span>");
                valida=false;
            }

            if(valida){
                var formData = new FormData();
                formData.append("action", "editnotas");

                formData.append("nota1", parseFloat($("#nota1e").val()));
                formData.append("nota2", parseFloat($("#nota2e").val()));
                formData.append("nota3", parseFloat($("#nota3e").val()));
                formData.append("nota4", parseFloat($("#nota4e").val()));
                formData.append("examen", parseFloat($("#examene").val()));
                formData.append("ids", $("#editarNotas").attr('ids'));

                Swal.fire({
                    title: "Alerta!",
                    text: "¿Está seguro de ingresar las notas?",
                    icon: "question",
                    showCancelButton: true,
                    confirmButtonColor: "#0d437d",
                    cancelButtonColor: "#d33",
                    confirmButtonText: "Guardar",
                    cancelButtonText: "Cancelar"
                }).then(function(result){
                    if (result.isConfirmed) {
                        $.ajax({
                            url: "/solicitud_materiaonline",
                            type: "POST",
                            data: formData,
                            processData: false,
                            contentType: false,
                            success: function(data) {
                                if (data.result == 'ok') {
                                    Swal.fire('Notificación !', 'Notas editadas correctamente', 'success').then(function(){
                                        $("#modalnotasedit").modal("hide");
                                        location.reload()
                                    });

                                } else {
                                    Swal.fire('Notificación !', 'Error', 'warning');
                                }
                            },
                            error: function() {
                                Swal.fire('Notificación !', 'Errora al ingresar de notas', 'error');
                            }
                        });
                    }
                });
            }
        });


    });
    </script>
{% endblock %}

{% block canvas %}
    <style type="text/css">
        .card {
            border-radius: 5px;
            padding: 1em;
            box-shadow: 5px 5px 10px 0px rgba(0,0,0,0.2);
            color: #000000;
        }

        .card-info {
            background: #eee;
            position: relative;
            padding-left: 2em;
        }

        .card-success {
            background: lightgreen;
            position: relative;
            padding-left: 2em;
        }
        .num {
            position: absolute;
            width: 40px;
            height: 40px;
            background: none;
            color: #000000;
            background:  white;
            box-shadow: 0px 0px 35px 0px rgba(0,0,0,0.2);
            text-align: center;
            vertical-align: middle;
            top: -10px;
            left: -15px;
            font-size: 1.5rem;
            line-height: 40px;
            border-radius: 50%;
        }
    </style>

    <div class='row-fluid'>
        <div class='span11'>
            <h3>Listado de Solicitud Materia Online</h3>
        </div>
        <div class='atright'>
            <a href="/" class='btn'><i class="icon-arrow-left"></i> Atr&aacute;s</a>
        </div>
    </div>
    <br>
    <div class="row-fluid">
        <div class="span1"></div>
        <div class="span10">
            <div class="row-fluid">
                <div class="span12">
                    <div style="display: flex; gap:1.3em;" class="content">
                        <p style="width: 14%" class="card card-info"><span class="num">1</span>
                            El proceso inicia con una solicitud ingresada por el coordinador de carrera, dando click al boton "Nueva Solicitud".
                        </p>
                        <p style="width: 14%" class="card card-info"><span class="num">2</span>
                            Luego de generar la solicitud, aparecerá una opcion en el boton "Acciones" para "Ingresar Nota" del estudiante (Este boton aparecera al coordinador que esta realizando la solicitud).
                        </p>
                        <p style="width: 14%" class="card card-info"><span class="num">3</span>
                            Luego de ingresar las notas, aparecerá unas opciones para "Editar Nota" o "Enviar a Secretaria" (Estas acciones apareceran al coordinador que esta realizando la solicitud).
                        </p>
                        <p style="width: 14%" class="card card-info"><span class="num">4</span>
                            Al dar click a "Enviar a Secreteria", se enviará un correo a los usuarios de secretaria con la informacion del estudiante, su asignatura, observacion y nota.
                        </p>
                        <p style="width: 14%" class="card card-info"><span class="num">5</span>
                            En el perfil de Secretaria se habilitar en el boton "Acciones" una opcion para "Aprobar Solicitud" o "Ver Notas".
                        </p>

                        <p style="width: 14%" class="card card-info"><span class="num">6</span>
                            Al dar click en el boton "Ver Nota" se mostrara una tabla con el detalle de todas notas.
                        </p>

                        <p style="width: 14%" class="card card-info"><span class="num">7</span>
                            Una vez aprobada la solicitud, se actualizara el estado de la solicitud, en caso que la solicitud sea reprobada el coordinador puede editar las notas y volver a enviar la solicitud a secretaria.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div><br>
    <div class="row-fluid">
        <div class='span4'>
            <form class="form-search">
            <input class='searchinput input-large search-query' type='text' id='searchfield' value='{{ search }}'/>
            <a href="#" id='search' class='btn btn-info'><i class="icon-search icon-white"></i> Buscar</a>
            {% if search %}
                <a href="/solicitud_materiaonline" id='allresults' class='btn btn-primary'><i class="icon-refresh icon-white"></i> Todos</a>
            {% endif %}
            </form>
        </div>
        <div class='span2'>
            {% if persona.es_coordinador %}
            <a href="#" id="agregarsolicitudmateria" class='btn btn-success'><i class="icon-plus icon-white"></i> Nueva Solicitud</a>
            {% endif %}
        </div>

    </div>

    <div class='row-fluid'>
        <div class='span12'>
        <table class='table table-bordered table-striped' cellpadding="0" cellspacing="0">
            <thead>
            <tr>
                <th style="width:10%">Nro. Solicitud</th>
                <th >Asignatura</th>
                <th >Estudiante</th>
                <th >Grupo</th>
                <th >Observacion</th>
                <th style="text-align: center">Evidencia</th>
                <th style="text-align: center">Estado</th>

                <th style="width: 20px"> </th>
            </tr>
            </thead>
            <tbody>
            {% for solicitud in solicitudmateria %}
                <tr>
                    <td>{{ solicitud.id }}</td>

                    <td>{{ solicitud.asignatura.asignatura.nombre }}<br>
                        {% if persona.es_coordinador %}
                            {% if solicitud.notafinal %}
                                {% if solicitud.enviado %}
                                    {% if not solicitud.aprobado %}
                                        <span class="badge badge-info"> Enviada Pendiente de Aprobacion</span>
                                    {% else %}
                                       <span class="badge badge-success"> Aprobada</span>
                                    {% endif %}
                                {% else %}
                                    {% if solicitud.observacionaprob %}
                                        <span class="badge badge-warning"> {{ solicitud.observacionaprob }}</span>
                                    {% endif %}
                                    <span class="badge badge-info"> Enviar a secretaria</span>
                                {% endif %}
                            {% else %}
                                <span class="badge badge-info"> Ingrese nota</span>
                            {% endif %}
                        {% endif %}
                    </td>
                    <td>{{ solicitud.inscripcion.persona.nombre_completo_inverso }}</td>
                    <td>{{ solicitud.grupo}}</td>
                    <td>{{ solicitud.observacion }}</td>
                    <td style="text-align: center">{% if solicitud.archivo %}<a href="{{ solicitud.archivo.url }}">Ver Archivo</a>{% endif %}</td>
                    <td style="text-align: center">
                        {% if solicitud.aprobado %}
                                <img src='/static/images/16/true.png' alt='Si' border='0'/>
                            {% else %}
                                <img src='/static/images/16/false.png' alt='No' border='0'/>
                            {% endif %}
                    </td>
                    <td>
                        <div class="btn-group">
                            <a  class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#">
                                Acciones
                            </a>
                            {% if not solicitud.aprobado %}
                                <ul class="dropdown-menu pull-right">
                                    {% if persona.es_coordinador %}
                                        {% if solicitud.notafinal %}
                                            {% if not solicitud.enviado %}
                                                <li><a  href='#' id='enviarsolicitud' ids='{{ solicitud.id }}' inscripcion='{{ solicitud.inscripcion.id }}'> <i class='icon-share-alt'></i> Enviar a Secretaria</a></li>
                                                <li><a  href='#' id='editarNotas' ids='{{ solicitud.id }}' nota1="{{ solicitud.nota1|floatformat:0 }}" nota2="{{ solicitud.nota2|floatformat:0 }}" nota3="{{ solicitud.nota3|floatformat:0 }}" nota4="{{ solicitud.nota4|floatformat:0 }}" examen="{{ solicitud.examen|floatformat:0 }}"> <i class='icon-edit'></i> Editar Notas</a></li>
                                            {% endif %}
                                        {% else %}
                                            <li><a  href='#' id="agregarnotas" ids='{{ solicitud.id }}' idinscri='{{ solicitud.inscripcion.id }}' asig='{{ solicitud.asignatura.asignatura.id }}'> <i class='icon-edit'></i> Ingresar Notas </a></li>
                                        {% endif %}
                                    {% else %}
                                        {% if solicitud.notafinal %}
                                            <li><a href="/solicitud_materiaonline?action=vernotas&id={{ solicitud.id }}" ><i class="icon-eye-open"></i>Ver Notas</a></li>
                                        {% endif %}
                                        {% if not solicitud.aprobado %}
                                            {% if solicitud.enviado %}
                                                <li><a href="#" id="aprobarsolicitud" ids='{{ solicitud.id }}'><i class="icon-eye-open"></i>Aprobar Solicitud</a></li>
                                            {% endif %}
                                        {% endif %}
                                    {% endif %}
                                </ul>
                            {% endif %}
                        </div>
                    </td>
                </tr>
            {% endfor %}
            {% if not solicitudmateria %}
                <tr> <td colspan="8">NO EXISTE REGISTRO</td>   </tr>
            {% endif %}
            </tbody>

        </table>
        </div>
    </div>
    <div class='row-fluid'>
        <div class="span12">
            {% if paging.num_pages > 20 %}
                <div class='pagination'>
                    <ul>
                        {% if paging.primera_pagina %}
                            <li><a href="/solicitud_materiaonline?page=1">1</a></li>
                            <li><a href="/solicitud_materiaonline?page={{ paging.ellipsis_izquierda }}" class="active">...</a></li>
                        {% endif %}
                        {% for pagenumber in paging.paginas %}
                            <li {% if pagenumber == page.number %}class='active'{% endif %}><a href="/solicitud_materiaonline?page={{ pagenumber }}">{{ pagenumber }}</a></li>
                        {% endfor %}
                        {% if paging.ultima_pagina %}
                            <li><a href="/solicitud_materiaonline?page={{ paging.ellipsis_derecha }}" class="active">...</a></li>
                            <li><a href="/solicitud_materiaonline?page={{ paging.num_pages }}">{{ paging.num_pages }}</a></li>
                        {% endif %}
                    </ul>
                </div>
            {% else %}

                <div class='pagination'>
                    <ul>
                        {% for pagenumber in paging.page_range %}
                            <li {% if pagenumber == page.number %}class='active'{% endif %}><a href="/solicitud_materiaonline?{% if search %}s={{ search }}&{% endif %}page={{ pagenumber }}">{{ pagenumber }}</a></li>
                        {% endfor %}
                    </ul>
                </div>

            {% endif %}

        </div>
    </div>

{#    MODAL PARA NUEVA SOLICITUD DE MATERIA#}
    <div class="modal fade static" id="modalsolicitudmateria"   >
        <div class="modal-header">
            <h4 class="modal-title" id="paneltitle1">Nueva Solicitud</h4>
        </div>

        <div class="modal-body panelbody">
            <div id="formulario" >
                <fieldset class="control-group">
                    <div >
                        <label class="control-label" for="estudiante">Estudiante:</label>
                        <input type="text" id="estudiante" name="estudiante" class="input-xxlarge" autocomplete="off" myval="0" data-provide="typeahead"/>
                        <a href="#" id='buscaasignatura' class='btn btn-info'><i class="icon-search icon-white"></i> Buscar Asignatura</a>
                        <p class="help-textestudiante" style="color:red"> </p>
                    </div>

                    <div >
                        <label class="control-label" for="asignatura">Asignatura:</label>
                        <select id="cmbasignatura" name="cmbasignatura" style="width: 95%">
                            <option value="0">-----</option>
                        </select>
                        <p class="help-textasignatura"style="color:red"></p>
                    </div>

                    <div >
                        <label class="control-label" for="grupo">Grupo:</label>
                        <input type="text" name="grupo" id="grupo" class="input-xxlarge" style="font-size: 18px">
                        <p class="help-textgrupo" style="color:red;"> </p>
                    </div>

                    <div>
                        <label class="control-label" for="observacion">Observacion:</label>
                        <textarea id="observacion"  name="observacion" class="form-control" style="width: 510px" rows="6"></textarea>
                        <p class="help-textobservacion" style="color:red"> </p>
                    </div>
                    <div>
                        <div class="alert alert-danger" role="alert">
                            <h6 class="h6">SUBIR EVIDENCIA (Aquí ud. puede subir los archivos en donde se encuentre la evidencia del caso presentado, por favor no ingresar caracteres especiales, espacios en blanco)</h6>
                        </div>
                    </div>
                    <div>
                        <label class="control-label" for="evidencia">Subir Evidencia: </label>
                        <input id="subirevidencia" type="file" style="background-color: #eee" class="form-control-file form-control height-auto" size="4000">
                        <p class="helpsubirevidencia"  style="color:red"></p>
                        <p style="margin-top: 10px;font-size: 11px;color: red">Tamano Maximo permitido 4Mb,, en formato jpg, png, jpeg, pdf</p>
                    </div>

                </fieldset>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn btn-guardar btn-success">Guardar</a>
            <a href="#" class="btn btn-cerrar btn-warning">Salir</a>
        </div>
    </div>

{#    MODAL PARA INGRESAR NOTAS#}
    <div class="modal fade static" id="modalnotas" >
        <div class="modal-header">
            <h4 class="modal-title" id="paneltitle1"></h4>
        </div>
        <div class="modal-body panelbody">
            <div id="formulario"  > {#action="/solicitud_materiaonline" method="POST"#}
                <fieldset class="control-group">
{#                <input type='hidden' name='action' value='addnotas' />#}
                <input type='hidden' name='idsolicitud' id='idsolicitud' />
                    <div >
                        <b>Nota 1:</b>
                        <input type="text" name="nota1" id="nota1" class="input-mini bigger" style="font-size: 18px" onchange="validarNotas('nota1', '{{ porcnota1}}')">
                        <p class="help-text"> </p>
                    </div>
                    <div >
                        <b>Nota 2:</b>
                        <input type="text" name="nota2" id="nota2" class="input-mini bigger" style="font-size: 18px"  onchange="validarNotas('nota2', '{{ porcnota2}}')">
                        <p class="help-text"> </p>
                    </div>

                    <div>
                        <b>Nota 3:</b>
                        <input type="text" id="nota3"  name="nota3" class="input-mini bigger"  style="font-size: 18px" onchange="validarNotas('nota3', '{{ porcnota3}}')">
                        <p class="help-text"> </p>
                    </div>
                    <div>
                        <b>Nota 4:</b>
                        <input type="text" id="nota4"  name="nota4" class="input-mini bigger"  style="font-size: 18px"  onchange="validarNotas('nota4', '{{ porcnota4}}')">
                        <p class="help-text"> </p>
                    </div>
                    <div>
                        <b>Examen:</b>
                        <input type="text" id="examen"  name="examen" class="input-small"  style="font-size: 18px" onchange="validarNotas('examen', '{{ porcnota5 }}')">
                        <p class="help-text"> </p>
                    </div>
                    <div>
                        <b>Porcentaje de Asistencia:</b>
                        <input type="text" id="asistencia" name="asistencia" class="input-small"  style="font-size: 18px" onchange="validarNotas('asistencia', '{{ asistencia }}')">
                        <p class="help-text"> </p>
                    </div>
                </fieldset>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn btn-guardar btn-success">Guardar</a>
            <a href="#" class="btn btn-cerrar btn-warning">Salir</a>
        </div>
    </div>

{#    #}

    <div class="modal fade static" id="modalnotasedit" >
        <div class="modal-header">
            <h4 class="modal-title" id="paneltitle1"></h4>
        </div>
        <div class="modal-body panelbody">
            <div id="formulario"  > {#action="/solicitud_materiaonline" method="POST"#}
                <fieldset class="control-group">
                <input type='hidden' name='idsolicitud' id='idsolicitud' />
                    <div >
                        <b>Nota 1:</b>
                        <input type="text" name="nota1e" id="nota1e" class="input-mini bigger" style="font-size: 18px" onchange="validarNotas('nota1e', '{{ porcnota1}}')">
                        <p class="help-text"> </p>
                    </div>
                    <div >
                        <b>Nota 2:</b>
                        <input type="text" name="nota2e" id="nota2e" class="input-mini bigger" style="font-size: 18px"  onchange="validarNotas('nota2e', '{{ porcnota2}}')">
                        <p class="help-text"> </p>
                    </div>

                    <div>
                        <b>Nota 3:</b>
                        <input type="text" id="nota3e"  name="nota3e" class="input-mini bigger"  style="font-size: 18px" onchange="validarNotas('nota3e', '{{ porcnota3}}')">
                        <p class="help-text"> </p>
                    </div>
                    <div>
                        <b>Nota 4:</b>
                        <input type="text" id="nota4e"  name="nota4e" class="input-mini bigger"  style="font-size: 18px"  onchange="validarNotas('nota4e', '{{ porcnota4}}')">
                        <p class="help-text"> </p>
                    </div>
                    <div>
                        <b>Examen:</b>
                        <input type="text" id="examene"  name="examene" class="input-small"  style="font-size: 18px" onchange="validarNotas('examene', '{{ porcnota5 }}')">
                        <p class="help-text"> </p>
                    </div>

                </fieldset>
            </div>
        </div>
        <div class="modal-footer">
            <a href="#" class="btn btn-guardar btn-success">Guardar</a>
            <a href="#" class="btn btn-cerrar btn-warning">Salir</a>
        </div>
    </div>
{% endblock %}
