{% extends "basebs.html" %}
{% load humanize %}
{% load sga_extras %}
{% block heading %}
    <script type="text/javascript">
    $(function () {
        $(document).ready(function () {
            var tab_id = localStorage.getItem('tab_persona');
            var tab_collapse_id = localStorage.getItem('tab_persona_collapse');
            $('#' + tab_id).addClass('active');
            $('#' + tab_id + '_li_id').addClass('active');
            $('#' + tab_collapse_id).css('height', 'auto')
        })
        var id_actividad = 0
        $('#fechaDesde, #fechaHasta').datepicker({format: "dd-mm-yyyy" });
        busqueda = function () {
            var term = $("#searchfield").val().toUpperCase().trim();
            if (term.length > 0) {
                location.href = '/actividades_horaextra?admin{% if rechazadas %}&rechazadas{% endif %}&s=' + term +'&mescorte='+$('#id_mescorte').val()+'&anio='+$('#id_aniocorte').val();
            }
        };

        $("#search").click(function () {
            busqueda();
        });
        {% if error %}
            smoke.alert("{{ error }}");
        {% endif %}

        $('#searchfield').keyup(function (e) {
            if (e.keyCode == 13) {
                busqueda();
            }
        });
        registrar = function () {
            if ($('#descripcion').val() != '') {

                $('#helptxt').css('display', 'none')
                $.post('actividades_horaextra', {
                    action: 'add',
                    descripcion: $('#descripcion').val()
                }, function (data) {
                    if (data.result == 'ok') {
                        $('#iniciar_actividad').modal('hide')
                        Swal.fire('Registro Agregado Correctamente', '', 'success').then(function () {
                            location.reload()
                        })
                    } else {
                        Swal.fire('Error',
                                'Error al registrar, vuelva a intentarlo.',
                                'error');
                    }
                })


            } else {
                $('#descripcion').focus();
                $('#helptxt').css('display', 'block');
            }

        }
        modificar = function () {
            if ($('#descripcion_editar').val() != '') {
                $('#helptxt_editar').css('display', 'none');
                $.post('actividades_horaextra', {
                    action: 'editar',
                    id: id_actividad,
                    descripcion: $('#descripcion_editar').val(),
                    fechainicio: $('#fechainicio_actividad_atrasada').val() + ' ' + $('#horainicio_actividad_atrasada').val(),
                    fechafin: $('#fechafin_actividad_atrasada').val() + ' ' + $('#horafin_actividad_atrasada').val()
                }, function (data) {

                    if (data.result == 'ok') {
                        $('#editar_actividad').modal('hide');
                        Swal.fire('Actividad Modificada Correctamente', '', 'success').then(function () {
                            location.reload()
                        })
                    } else {
                        Swal.fire('Error', 'Error al registrar, vuelva a intentarlo.', 'error')
                    }
                })


            } else {
                $('#descripcion_editar').focus();
                $('#helptxt_editar').css('display', 'block');
            }

        }
        editar = function (id, descripcion, fechainicio, horainicio, fechafin, horafin) {
            $('#fechainicio_actividad_atrasada').val(fechainicio);
            $('#fechafin_actividad_atrasada').val(fechafin);
            $('#horainicio_actividad_atrasada').val(horainicio);
            $('#horafin_actividad_atrasada').val(horafin);
            $('#descripcion_editar').val(descripcion);
            $('#editar_actividad').modal('show');
            id_actividad = id;
        }
        generarExcel = function () {
            var tipo = '';
            var supervisor = '{{ supervisor }}';
            var director = '{{ director }}';
            var talento = '{{ talento }}';
            var auditor = '{{ auditor }}';
            if (supervisor) {
                tipo = 'supervisor'
            }
            if (director) {
                tipo = 'director'
            }
            if (talento) {
                tipo = 'talento'
            }
            if (auditor) {
                tipo = 'auditor'
            }
            $.post('actividades_horaextra', {
                action: 'excel',
                mescorte: $('#id_mescorte_excel').val(),
                aniocorte: $('#id_aniocorte_excel').val(),
                tipo: tipo,
                actividades:  $('#id_actividadesenviadas').val()
            }, function (data) {
                if (data.result == 'ok') {
                    $('#fecha_actividad').modal('hide');
                    Swal.fire({
                        title: 'Notificación',
                        icon: 'success',
                        text: 'Reporte Generado Correctamente',
                        showCancelButton: false,
                        confirmButtonText: 'Descargar',
                        confirmButtonColor: '#3085d6',
                        showLoaderOnConfirm: true
                    }).then(function (result) {
                                location.href = data.url;
                            })

                } else {
                    $('#fecha_actividad').modal('hide')
                    Swal.fire("Notificación", data.result, 'error');
                }
            })

        }
        enviarActividades = function (aprueba, supervisor, persona, nombre) {

            Swal.fire({
                title: 'Atención',
                icon: 'warning',
                html: '<div><span> Está seguro de enviar las actividades <b>aprobadas (<b style="color:blue">' + $('#id_aprobados' + persona).val() + '</b>)</b> de la persona : <b>' + nombre + '</b> y <b> Rechazar</b> las actividades <b>no aprobadas (<b style="color:red">' + $('#id_reprobados' + persona).val() + '</b>)</b></span> </div>',
                showCancelButton: true,
                confirmButtonText: 'Si',
                cancelButtonText: 'Cancelar',
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33'
            }).then(function (result) {
                        if (result.isConfirmed) {
                            $.post("actividades_horaextra", {
                                action: "enviar_aprobaciones",
                                persona: persona,
                                aprueba: aprueba,
                                supervisor: supervisor,
                                data: '{{ data }}'
                            }, function (data) {
                                if (data.result == 'ok') {
                                    Swal.fire('Actividades Enviadas ', '', 'success').then(function () {
                                        location.href = '/actividades_horaextra?admin{% if rechazadas %}&rechazadas{% endif %}{% if enviadas %}&enviadas{% endif %}&mescorte='+$('#id_mescorte').val()+'&anio='+$('#id_aniocorte').val()
                                    })
                                } else {
                                    Swal.fire('Error', 'Comuniquese con el Administrador', 'error').then(function () {
                                        location.href = '/actividades_horaextra?admin{% if rechazadas %}&rechazadas{% endif %}{% if enviadas %}&enviadas{% endif %}&mescorte='+$('#id_mescorte').val()+'&anio='+$('#id_aniocorte').val()
                                    })
                                }
                            })
                        }

                    })

        }
        aprobar = function (id, descripcion, estado, aprobacion_tipo, id_img, persona) {
            var observacion = '';
            var titulo = '';

            if ($('#' + id_img).attr('src') === '/static/images/16/true.png') {


                titulo = 'Desaprobar';
                estado = "True";
                Swal.fire({
                    title: titulo + ' Actividad',
                    icon: 'warning',
                    html: '<div><span> ¿ Está seguro en ' + titulo + ' la actividad :  <br><b>' + descripcion + '</b> ?</span> </div>',
                    showCancelButton: true,
                    confirmButtonText: titulo,
                    cancelButtonText: 'Cancelar',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33',
                    input: 'text',
                    inputLabel: 'Observación: ',
                    inputValidator: function (value) {
                        if (!value) {
                            return 'Observación requerida!'
                        } else {
                            observacion = value
                        }
                    }
                }).then(function (result) {

                            if (result.isConfirmed) {

                                $.post("actividades_horaextra", {
                                    action: "aprobar_actividad",
                                    id: id,
                                    observacion: observacion,
                                    aprobacion_tipo: aprobacion_tipo,
                                    estado: estado
                                }, function (data) {
                                    if (data.result == 'ok') {
                                        if (titulo == 'Aprobar') {

                                            $('#' + id_img).attr('src', '/static/images/16/true.png')
                                        } else {
                                            $('#' + id_img).attr('src', '/static/images/16/false.png')
                                        }
                                        total_act_aprobadas = parseInt($('#id_aprobados' + persona).val());
                                        total_act_reprobadas = parseInt($('#id_reprobados' + persona).val());
                                        $('#id_aprobados' + persona).val(total_act_aprobadas - 1);
                                        $('#id_reprobados' + persona).val(total_act_reprobadas + 1);
                                    } else {
                                        Swal.fire('Error', 'Comuniquese con el Administrador.', 'error')
                                    }
                                })
                            }
                        })
            } else {

                titulo = 'Aprobar';
                estado = "False";
                Swal.fire({
                    title: titulo + ' Actividad',
                    icon: 'warning',
                    html: '<div><span> ¿ Está seguro en ' + titulo + ' la actividad :  <br><b>' + descripcion + '</b> ?</span> </div>',
                    showCancelButton: true,
                    confirmButtonText: titulo,
                    cancelButtonText: 'Cancelar',
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#d33'
                }).then(function (result) {

                            if (result.isConfirmed) {
                                $.post("actividades_horaextra", {
                                    action: "aprobar_actividad",
                                    id: id,
                                    aprobacion_tipo: aprobacion_tipo,
                                    estado: estado
                                }, function (data) {
                                    if (data.result == 'ok') {
                                        if (titulo == 'Aprobar') {

                                            $('#' + id_img).attr('src', '/static/images/16/true.png');
                                        } else {
                                            $('#' + id_img).attr('src', '/static/images/16/false.png');
                                        }
                                        $('#id_spandesaprobado').css('display', 'none');
                                        total_act_aprobadas = parseInt($('#id_aprobados' + persona).val());
                                        total_act_reprobadas = parseInt($('#id_reprobados' + persona).val());
                                        $('#id_aprobados' + persona).val(total_act_aprobadas + 1);
                                        $('#id_reprobados' + persona).val(total_act_reprobadas - 1);
                                    } else {
                                        Swal.fire('Error', 'Comuniquese con el Administrador.', 'error')
                                    }
                                })
                            }
                        })
            }


        }
        eliminar = function (id, actividad) {
            Swal.fire({
                title: 'Eliminar Actividad',
                icon: 'warning',
                html: '<div ><span>¿Está seguro en <b>Eliminar</b> la actividad?</span><br><span><b>' + actividad + '</b> </span> </div>',
                showCancelButton: true,
                confirmButtonText: 'Aceptar',
                cancelButtonText: 'Cancelar',
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                showLoaderOnConfirm: true
            }).then(function (result) {

                        if (result.isConfirmed) {
                            $.post('actividades_horaextra', {
                                action: 'eliminar',
                                id: id
                            }, function (data) {
                                if (data.result == 'ok') {
                                    Swal.fire('Actividad Eliminada Correctamente', '', 'success').then(function () {
                                        location.reload()
                                    })
                                } else {
                                    Swal.fire('Error', 'Error al Eliminar la actividad.', 'error')
                                }
                            })
                        }
                    })

        }
        accordion_test = function (id) {
            if ($('#collapse' + id).css('height') === '0px') {
                $('#collapse' + id).css('height', 'auto');
                localStorage.setItem('tab_persona_collapse', 'collapse' + id);
            } else {
                $('#collapse' + id).css('height', '0px');
                localStorage.removeItem('tab_persona_collapse');
            }
        }

        tabActivo = function (tabid) {
            localStorage.setItem('tab_persona', tabid);
        }

        tipoExcel = function(t){
            $('#id_actividadesenviadas').val(t)

        }


        actividadEnviadas = function(){
            location.href = "/actividades_horaextra?admin&enviadas&mescorte="+$('#id_mescorte').val()+"&anio="+$('#id_aniocorte').val()
        };
        actividadesDesaporbadas = function(){
            location.href = "/actividades_horaextra?admin&rechazadas&mescorte="+$('#id_mescorte').val()+"&anio="+$('#id_aniocorte').val()
        };
        actividadActuales = function(){
            location.href = "/actividades_horaextra?admin&mescorte="+$('#id_mescorte').val()+"&anio="+$('#id_aniocorte').val()
        }

        $('#id_mescorte, #id_aniocorte').change(function () {
            location.href="/actividades_horaextra?admin{% if enviadas %}&enviadas{% endif %}{% if rechazadas %}&rechazadas{% endif %}&mescorte="+$('#id_mescorte').val()+"&anio="+$('#id_aniocorte').val()
        })
    });


    </script>

    <style type="text/css">

        .tabs-left>.nav-tabs .active>a, .tabs-left>.nav-tabs .active>a:hover{
            color: #fff;
            text-shadow: 0 -1px 0 rgba(0,0,0,0.25);
            background-color: #49afcd;
        }
    </style>
{% endblock %}
{% block atras %}/{% endblock %}
{% block canvas %}


    <div class='row-fluid'>
        <div class="span3">
             {% if director %}<h3><span class="alert alert-danger"> Director</span></h3>{% endif %}
             {% if supervisor %}<h3><span class="alert alert-danger"> Supervisor</span></h3>{% endif %}
             {% if talento %}<h3><span class="alert alert-danger">Talento</span></h3>{% endif %}
             {% if auditor %}<h3><span class="alert alert-danger">Auditor</span></h3>{% endif %}
        </div>
        <div class='span6' style="text-align: center">
            <h3><span class="alert alert-info">{{ title }}</span></h3>


        </div>
    </div>

    <br/>
    <div class="row-fluid">
         <div class='span12'>
            <div class='span5' style="text-align: left">
                <form class="form-search">
                    <input class='searchinput input-large search-query' type='text' id='searchfield' value='{{ search }}' placeholder="Actividad o Persona"/>
                    <a href="#" id='search' class='btn btn-info'><i class="icon-search icon-white"></i> Buscar</a>
                    {% if search %}
                        <a onclick="actividadActuales()" id='allresults' class='btn btn-info'><i class="icon-refresh icon-white"></i> Todos</a>
                    {% endif %}
                </form>
            </div>
            <div class='span1' style="text-align: right">

            </div>
            <div class='span6' style="text-align: right">

                {% if rechazadas or enviadas %}
                    {% if not rechazadas %}
                       <a  data-toggle="modal" data-target="#fecha_actividad" onclick="tipoExcel(1)"  class='btn btn-success'><i><img src="/static/images/excel.png"/></i> Generar Excel </a>
                    {% endif %}
                    <a class="btn btn-primary" onclick="actividadActuales()"><i class="icon-list-ol icon-white"></i> Actividades Actuales</a>
                {% else %}
                     <a  data-toggle="modal" data-target="#fecha_actividad" onclick="tipoExcel(0)"   class='btn btn-success'><i><img src="/static/images/excel.png"/></i> Generar Excel </a>
                    <a class="btn btn-info" onclick="actividadEnviadas()" ><i class="icon-ok-sign icon-white"></i> Actividades Enviadas</a>
                    <a class="btn btn-danger" onclick="actividadesDesaporbadas()" ><i class="icon-remove-sign icon-white"></i> Actividades Desaprobadas</a>
                {% endif %}

            </div>
        </div>
        <div class="span12 " style=" margin-left: 0 ">
            <div class="span6" style="text-align: left; ">

                <label style="display: inline-block;" for="">Mes Corte : </label>
                <select name="" id="id_mescorte" class="input-medium bigger">
                    {% for m in meses %}
                        <option  value="{{ m.0 }}" {% if mes == m.0 %}selected{% endif %}>{{ m.1 }}</option>
                    {% endfor %}
                </select>
                <label style="display: inline-block;" for="">Año Corte : </label>
                    <select name="" id="id_aniocorte" class="custom-select2" style="width: 10%">
                            <option  value="2023" {% if anio == "2023" %}selected{% endif %}>2023</option>
                            <option  value="2024" {% if anio == "2024" %}selected{% endif %}>2024</option>
                    </select>
            </div>
        </div>
    </div>
    <div class='row-fluid'  style="text-align: right">
        <div class='span12'>

            <table class='table table-striped table-bordered' cellpadding="0" cellspacing="0">
                  <thead>

                    <tr>
                        <th>Jefes Departamentos</th>
                       <th style="width: 90%;">Actividades</th>
                    </tr>
                </thead>
                <tbody>
                    {%  if supervisor_actividades %}
                    <tr>
                        <th style="padding-left: 0; padding-right: 0">
                         <div class="tabbable tabs-left">
                              <ul class="nav nav-tabs " style="margin-right: 0; border-right: 0; width: 100%;">
                                  {% for s in supervisor_actividades %}
                                       <li id="tab{{ s.supervisor.id }}_li_id" class=""><a onclick="tabActivo('tab{{ s.supervisor.id }}')" href="#tab{{ s.supervisor.id }}" data-toggle="tab">{{ s.supervisor.supervisor.nombre_completo_inverso }}<br> <span class="badge badge-dark ">{% for g in s.supervisor.grupo.all %} {{ g }} {% if not forloop.last %}|{% endif %}  {% endfor %}</span> </a></li>
                                  {% endfor %}
                              </ul>
                         </div>
                        </th>
                        <th >
                        <div class="tab-content">

                            {% for s in supervisor_actividades %}

                             <div class="tab-pane " id="tab{{ s.supervisor.id }}">
                                <div class="accordion" id="accordion{{ s.supervisor.id }}">


                                     {% for p in s.personas %}
                                          <div class="accordion-group">
                                            <div class="accordion-heading">
                                              <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion{{ s.supervisor.id }}" href="#collapse{{ p.personas.id }}" onclick="accordion_test('{{ p.personas.id }}')">
                                                {{ p.personas.nombre_completo_inverso }}
                                              </a>
                                            </div>
                                            <div id="collapse{{ p.personas.id }}" class="accordion-body collapse in">
                                              <div class="accordion-inner">
                                                 <table class='table table-striped table-bordered' cellpadding="0" cellspacing="0">
                                                     <thead>
                                                        <tr>
                                                             <th style="width: 20%;">Actividad</th>
                                                             <th style="width: 10%;text-align: center;">Fecha y Hora Inicio</th>
                                                             <th style="width: 10%;text-align: center;">Fecha y Hora Fin</th>
                                                                <th style="width: 10%;text-align: center;">Aprobado Supervisor </th>
                                                                <th style="width: 10%;text-align: center;">Aprobado Director </th>
                                                                <th style="width: 10%;text-align: center;">Aprobado Talento Humano </th>
                                                                <th style="width: 10%;text-align: center;">Aprobado Auditor</th>
                                                           {% if rechazadas %}
                                                               <th style="width: 10%;text-align: center;">Rechazado</th>
                                                               <th style="width: 10%;text-align: center;">Rechazado por:</th>
                                                           {% endif %}
                                                            <th style="width: 10%;text-align: center;">Horas Extra</th>
                                                              {% if not rechazadas and not enviadas %}
                                                                {% if director %}
                                                                    <th style="width: 12%; text-align: center">
                                                                        <input style="display: none" id="id_aprobados{{ p.personas.id }}" value="{{ p.actividades_aprobadas }}" type=""/>
                                                                        <input style="display: none" id="id_reprobados{{ p.personas.id }}" value="{{ p.actividades_reprobadas }}" type=""/>
                                                                        {% if not p.no_aprobado_auditoria %}
                                                                            <a  class="btn btn-danger"   onclick="enviarActividades('director','{{ s.supervisor.supervisor.id }}','{{ p.personas.id }}','{{ p.personas.nombre_completo_inverso }}')" >Enviar Talento </a>

                                                                        {% endif %}
                                                                    </th>
                                                                {% endif %}
                                                                {% if supervisor %}
                                                                    <th style="width: 12%; text-align: center">
                                                                        <input style="display: none" id="id_aprobados{{ p.personas.id }}" value="{{ p.actividades_aprobadas }}" type=""/>
                                                                        <input style="display: none" id="id_reprobados{{ p.personas.id }}" value="{{ p.actividades_reprobadas }}" type=""/>
                                                                        <a  class="btn btn-danger" onclick="enviarActividades('supervisor','{{ s.supervisor.supervisor.id }}','{{ p.personas.id }}','{{ p.personas.nombre_completo_inverso }}')" >Enviar Director  </a>
                                                                    </th>
                                                                {% endif %}
                                                                {% if talento %}
                                                                    <th style="width: 12%; text-align: center">
                                                                        <input style="display: none" id="id_aprobados{{ p.personas.id }}" value="{{ p.actividades_aprobadas }}" type=""/>
                                                                        <input style="display: none" id="id_reprobados{{ p.personas.id }}" value="{{ p.actividades_reprobadas }}" type=""/>
                                                                        <a  class="btn btn-danger" onclick="enviarActividades('talento','{{ s.supervisor.supervisor.id }}','{{ p.personas.id }}','{{ p.personas.nombre_completo_inverso }}')">Enviar Auditoria</a>
                                                                    </th>
                                                                {% endif %}
                                                                {% if auditor %}
                                                                    <th style="width: 12%; text-align: center">
                                                                         <input style="display: none" id="id_aprobados{{ p.personas.id }}" value="{{ p.actividades_aprobadas }}" type=""/>
                                                                        <input style="display: none" id="id_reprobados{{ p.personas.id }}" value="{{ p.actividades_reprobadas }}" type=""/>
                                                                        <a  class="btn btn-danger" onclick="enviarActividades('auditoria','{{ s.supervisor.supervisor.id }}','{{ p.personas.id }}','{{ p.personas.nombre_completo_inverso }}')">Aprobar Registros </a>
                                                                    </th>
                                                                {% endif %}
                                                              {% else %}
                                                                  <th></th>
                                                            {% endif %}

                                                        </tr>
                                                     </thead>
                                                    <tbody>
                                                      {% for actividad in p.actividades %}
                                                          <tr>
                                                            <td>{{ actividad.descripcion|linebreaksbr }} {% if not actividad.aprobado_supervisor or not actividad.aprobado_director or not actividad.aprobado_talento or not actividad.aprobado_auditoria %} <span id="id_spandesaprobado" class="badge badge-info">Desaprobado razón: {{ actividad.observacion|linebreaksbr }}</span>{% endif %}</td>
                                                             <td>{% if actividad.fecha_inicio  %} <b>Día:</b> {{ actividad.fecha_inicio|date:"Y-m-d"}} <br> <b>Hora:</b> {{ actividad.fecha_inicio|date:"H:i" }} {% endif %}</td>
                                                            <td>{% if actividad.fecha_fin  %} <b>Día:</b> {{ actividad.fecha_fin|date:"Y-m-d" }} <br> <b>Hora:</b> {{ actividad.fecha_fin|date:"H:i" }} {% endif %}</td>

                                                                 <td style="text-align: center" >

                                                                     <a
                                                                      {% if supervisor and not rechazadas and not enviadas %}
                                                                         onclick="aprobar('{{ actividad.id }}','{{ actividad.descripcion|linebreaksbr }}','{{ actividad.aprobado_supervisor }}', 'supervisor','id_imacts{{ actividad.id }}', '{{ p.personas.id }}')"
                                                                     {% endif %}>
                                                                     {% if actividad.aprobado_supervisor %}
                                                                         <img {% if not supervisor and not enviadas %} style="filter: grayscale(1);"{% else %} {% if enviadas and actividad.enviar_supervisor  %}style="" {% endif %} {% endif %} id='id_imacts{{ actividad.id }}' src="/static/images/16/true.png"/>
                                                                     {%  else %}
                                                                         <img {% if not supervisor %} style="filter: grayscale(1);" {% endif %} id='id_imacts{{ actividad.id }}' src="/static/images/16/false.png"/>
                                                                     {% endif %}

                                                                     </a>

                                                                 </td>
                                                                 <td style="text-align: center" >
                                                                     <a
                                                                         {% if director and not rechazadas and not enviadas %}
                                                                                    onclick="aprobar('{{ actividad.id }}','{{ actividad.descripcion|linebreaksbr }}','{{ actividad.aprobado_director }}', 'director','id_imactd{{ actividad.id }}', '{{ p.personas.id }}')"
                                                                         {% endif %}>
                                                                         {% if actividad.aprobado_director %}
                                                                             <img {% if not director and not enviadas  %} style="filter: grayscale(1);" {% else %} {% if enviadas and actividad.enviar_director  %}style="" {% endif %} {% endif %} id='id_imactd{{ actividad.id }}' src="/static/images/16/true.png"/>
                                                                         {%  else %}
                                                                             <img {% if not director %} style="filter: grayscale(1);" {% endif %} id='id_imactd{{ actividad.id }}' src="/static/images/16/false.png"/>
                                                                         {% endif %}
                                                                     </a>
                                                                 </td>
                                                                 <td style="text-align: center" ><a
                                                                     {% if talento and not rechazadas and not enviadas %}
                                                                         onclick="aprobar('{{ actividad.id }}','{{ actividad.descripcion|linebreaksbr }}','{{ actividad.aprobado_talento }}', 'talento','id_imactt{{ actividad.id }}', '{{ p.personas.id }}')"
                                                                     {% endif %}>
                                                                     {% if actividad.aprobado_talento %}
                                                                         <img {% if not talento and not enviadas %} style="filter: grayscale(1);" {% else %} {% if enviadas and actividad.enviar_director  %}style="" {% endif %} {% endif %} id='id_imactt{{ actividad.id }}' src="/static/images/16/true.png"/>
                                                                     {%  else %}
                                                                         <img {% if not talento %} style="filter: grayscale(1);" {% endif %} id='id_imactt{{ actividad.id }}' src="/static/images/16/false.png"/>
                                                                     {% endif %}
                                                                 </a>
                                                                 </td>

                                                                 <td style="text-align: center" ><a
                                                                     {% if auditor and not rechazadas %}
                                                                         onclick="aprobar('{{ actividad.id }}','{{ actividad.descripcion|linebreaksbr }}','{{ actividad.aprobado_auditoria }}', 'auditoria','id_imacta{{ actividad.id }}', '{{ p.personas.id }}')"
                                                                     {% endif %}>
                                                                     {% if actividad.aprobado_auditoria %}
                                                                         <img {% if not auditor and not enviadas  %} style="filter: grayscale(1);" {% else %} {% if enviadas and actividad.enviar_auditoria  %}style="" {% endif %}{% endif %} id='id_imacta{{ actividad.id }}' src="/static/images/16/true.png"/>
                                                                     {%  else %}
                                                                         <img {% if not auditor %} style="filter: grayscale(1);" {% endif %} id='id_imacta{{ actividad.id }}' src="/static/images/16/false.png"/>
                                                                     {% endif %}</a>
                                                                 </td>
                                                               {% if rechazadas %}
                                                                   <td style="text-align: center"><a >{% if actividad.rechazado %} <img src="/static/images/16/true.png"/> {%  else %} <img src="/static/images/16/false.png"/> {% endif %}</a></td>
                                                                    <td><span class="badge badge-info">{{ actividad.departamento_rechaza }}</span></td>
                                                               {% endif %}
                                                            <td style="text-align: center">{% if actividad.horas_extras %}<b>Horas : </b>{{  actividad.horas_extras }} {% endif %}</td>
                                                              <td style="overflow: visible; text-align: center">
                                                                    <div class="btn-group">
                                                                        <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#">Acciones<span class="caret"></span></a>
                                                                        <ul class="dropdown-menu pull-right">
                                                                            {% if supervisor or auditor or director or auditor or talento %}
                                                                                <li style="text-align: left"><a onclick="editar('{{ actividad.id }}','{{ actividad.descripcion|linebreaksbr }}','{{ actividad.fecha_inicio|date:"Y-m-d" }}','{{ actividad.fecha_inicio|date:"H:i" }}','{{ actividad.fecha_fin|date:"Y-m-d" }}','{{ actividad.fecha_fin|date:"H:i" }}')"><span class="icon-edit" style="font-style: italic;"></span> Editar</a></li>
                                                                            {% endif %}
                                                                            <li style="text-align: left"><a onclick="eliminar('{{ actividad.id }}','{{ actividad.descripcion|linebreaksbr }}')" ><span class="icon-remove" style="font-style: italic;"></span> Eliminar</a></li>

                                                                        </ul>
                                                                    </div>
                                                              </td>
                                                           </tr>
                                                        {% endfor %}
                                                        <tr>
                                                            <td {% if rechazadas %} colspan="9" {% else %} colspan="7"  {% endif %}>Total Horas Extras</td>

                                                            <td style="text-align: center" >Horas : {{ p.hora_extra_total }}</td>
                                                            <td ></td>
                                                        </tr>

                                                    </tbody>
                                                  </table>
                                              </div>
                                            </div>
                                          </div>
                                     {% endfor %}


                                </div>
                             </div>
                            {% endfor %}

                        </div>
                        </th>
                    </tr>
                    {% endif %}
                     {% if not supervisor_actividades %}
                        <tr>
                            <td colspan="2" style="background-color: lightsteelblue"><i> NO HAY REGISTROS DE ACTIVIDADES</i></td>
                        </tr>
                     {% endif %}
                </tbody>

            </table>




        </div>
    </div>
{% endblock %}
{% block moreblock %}
    <div  class="modal fade " id="editar_actividad" >
        <div class="modal-header">

            <h4 class="modal-title" id="myLargeModalLabel">Registro Actividad</h4>

        </div>

        <div class="modal-body"  >

            <div class="row-fluid">
                   <div class="span6">
                                <label for="">Fecha de Inicio <span style="color: red;">(*) : </span></label>
                                 <input id="fechainicio_actividad_atrasada" type="date" />
                                 <label for="">Hora Inicio <span style="color: red;">(*) : </span></label>
                                <input id="horainicio_actividad_atrasada" type="time" />
                            </div>
                            <div class="span6">
                                 <label for="">Fecha de Fin <span style="color: red;">(*) : </span> </label>
                                <input id="fechafin_actividad_atrasada" type="date" />
                                 <label for="">Hora Fin <span style="color: red;">(*) : </span></label>
                                 <input id="horafin_actividad_atrasada" type="time" />
                            </div>
            </div>


                      <label for="">Actividad <span style="color: red;">(*) : </span></label>
                        <textarea  id='descripcion_editar' rows="7" style="width: 97%" ></textarea>


                    <h6 id="helptxt_actividad_atrasada" style="color: red;display: none"> Campos Obligatorios</h6>

        </div>

        <div class="modal-footer">
            <button type="button"  class="btn btn-success" onclick="modificar()" >Ingresar</button>
            <button type="button"  class="btn btn-danger" data-dismiss="modal" >Salir</button>
        </div>
    </div>



     <div  class="modal fade " id="fecha_actividad" style="width: 20%;" >
         <input id="id_actividadesenviadas" type="" style="display: none"/>
        <div class="modal-header">

            <h4 class="modal-title" id="myLargeModalLabel">Fecha Actividad</h4>

        </div>

        <div class="modal-body" style="text-align: center; width: 60%; margin: 0 auto"  >
            <div class="row-fluid">
                <div class="span6">
                    <label style="display: inline-block;" for="">Mes Corte : </label>
                    <select name="" id="id_mescorte_excel" class="input-medium bigger">
                        {% for m in meses %}
                            <option value="{{ m.0 }}" {% if mes == m.0 %}selected{% endif %}>{{ m.1 }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="span6">
                   <label style="display: inline-block;" for="">Año Corte : </label>
                    <select name="" id="id_aniocorte_excel" class="custom-select2" style="width: 100%">
                        <option value="2023" {% if anio == "2023" %}selected{% endif %}>2023</option>
                        <option value="2024" {% if anio == "2024" %}selected{% endif %}>2024</option>
                    </select>
                </div>

            </div>
        </div>

        <div class="modal-footer">
            <button type="button"  class="btn btn-success" onclick="generarExcel()" >Generar</button>
            <button type="button"  class="btn btn-danger" data-dismiss="modal" >Salir</button>
        </div>
    </div>
{% endblock %}
