{% extends "basebs.html" %}
{% block heading %}
    <script type="text/javascript">
        $(function() {
            var nota1=0;
            var nota2=0;
            var nota3=0;
            var nota4=0;
            var examen=0;
            var recupera = 0;

            var notaalcance=0;
            var alcancenota1=0;
            var alcancenota2=0;
            var alcancenota3=0;
            var alcancenota4=0;
            var alcanceexamen=0;
            var alcancerecupera = 0;
            var reprobado={{ reprobado }};
            var posicion='';
            var idmateriaasig=0;
            var profesor=0;

            var apruebaparciales=0;
            var apruebaexamen=0;
            var apruebarecuperacion=0;

             $(".nota1").change(function(){
                 porcnota1={{porcnota1}};
                 nota1= ($(this).val());
                 asignada=$(this).attr("maid");
                 if (nota1 > porcnota1){
                     ($(this).val(0));
                     nota1=0;
                 }
                 else{
                      actualizarnotas(nota1,asignada,'n1')
                 }
             });

             $(".nota2").change(function(){
                porcnota2={{porcnota2}};
                 nota2= ($(this).val());
                 asignada=$(this).attr("maid");
                 if (nota2 > porcnota2){
                     ($(this).val(0));
                     nota2=0;
                 }
                 else{
                      actualizarnotas(nota2,asignada,'n2')
                 }
             });

             $(".nota3").change(function(){
                porcnota3={{porcnota3}};
                nota3= ($(this).val());
                asignada=$(this).attr("maid");
                if (nota3 > porcnota3){
                    ($(this).val(0));
                    nota3=0;
                }
                 else{
                 actualizarnotas(nota3,asignada,'n3')
                }
             });

             $(".nota4").change(function(){
                porcnota4={{porcnota4}};
                nota4= ($(this).val());
                asignada=$(this).attr("maid");
                if (nota4 > porcnota4){
                    ($(this).val(0));
                    nota4=0;
                }
                else{
                    actualizarnotas(nota4,asignada,'n4')
                }
             });

             $(".notaexamen").change(function(){
                examen= ($(this).val());
                porcnota5={{porcnota5}};
                asignada=$(this).attr("maid");
                if (examen > porcnota5){
                    ($(this).val(0));
                    examen=0;
                }
                else{
                      actualizarnotas(examen,asignada,'examen')
                }
             });

            $(".notarecupera").change(function(){
                recupera= ($(this).val());
                asignada=$(this).attr("maid");
                actualizarnotas(recupera,asignada,'recuperacion')
            });

            $(".alcancenota1").change(function(){
                 porcnota1={{porcnota1}};
                 posicion='n1';
                 notaalcance= ($(this).val());
                 if (notaalcance > porcnota1){
                     ($(this).val(0));
                     notaalcance=0;
                 }
                 else{
                     asignada=$(this).attr("maid");
                     verifica_obsmot(asignada)
                 }
             });

            $(".alcancenota1").blur(function(){
                notaalcance= ($(this).val());
                posicion='n1';
            });

             $(".alcancenota2").change(function(){
                 porcnota2={{porcnota2}};
                 posicion='n2';
                 notaalcance= ($(this).val());
                 if (notaalcance > porcnota2){
                     ($(this).val(0));
                     notaalcance=0;
                 }
             });

             $(".alcancenota2").blur(function(){
                notaalcance= ($(this).val());
                posicion='n2';
             });

             $(".alcancenota3").change(function(){
                 porcnota3={{porcnota3}};
                 posicion='n3';
                 notaalcance= ($(this).val());
                 if (notaalcance > porcnota3){
                     ($(this).val(0));
                     notaalcance=0;
                 }
             });

             $(".alcancenota3").blur(function(){
                notaalcance= ($(this).val());
                posicion='n3';
             });

             $(".alcancenota4").change(function(){
                 porcnota4={{porcnota4}};
                 posicion='n4';
                 notaalcance= ($(this).val());
                 if (notaalcance > porcnota4){
                     ($(this).val(0));
                     notaalcance=0;
                 }
             });
             $(".alcancenota4").blur(function(){
                notaalcance= ($(this).val());
                posicion='n4';
             });

             $(".alcanceexamen").change(function(){
                 notaalcance= ($(this).val());
                 porcnota5={{porcnota5}};
                 posicion='examen';
                 if (notaalcance > porcnota5){
                     ($(this).val(0));
                     notaalcance=0;
                 }
             });

             $(".alcanceexamen").blur(function(){
                notaalcance= ($(this).val());
                posicion='examen';
             });

            $(".alcancerecupera").blur(function(){
                recuperacion={{ min_exarecupera }}
                posicion='recuperacion';
                notaalcance= ($(this).val());
            });

            {#OCastillo 06-08-2019 llamar a esta funcion por cada cambio de nota            #}
            actualizarnotas = function (nota,asignada,posicion) {
                nota=nota;
                matasignada=asignada;
                posicion=posicion;
                 $.post("/aprobacion_nivelcerrado", {'action':'actualizanotas','matasignada': matasignada,'nota':nota,'posicion':posicion}, function(data) {
                    if (data.result=="ok") {
                        smoke.alert("El cambio sera validado ");
                        location.reload();
                    } else {
                        self.val(0);
                        location.reload();
                    }
                }, "json");
            };

            $(".actualizanotas").change(function(){
                 matasignada=$(this).attr("idmateria");
                 $.post("/aprobacion_nivelcerrado", {'action':'actualizanotas','matasignada': matasignada,'nota1':nota1,'nota2':nota2,'nota3':nota3,'nota4':nota4,'examen': examen,'recupera':recupera}, function(data) {
                    if (data.result=="ok") {
{#                        smoke.alert("Las nuevas notas seran validadas ");#}
                        location.reload();
                    } else {
                        self.val(0);
                        location.reload();
                    }
                }, "json");
            });



            buscar_materia = function(query, process) {
                $.get("/reportes", {'action':'data', 'model': 'Profesor',
                                    'p': 1, 'q': query, 's': 10}, function(data) {
                    if (data.results) {
                        $("#searchinput").get(0).results = data.results;
                        listing = [];
                        for (var i in data.results) {
                            var dato = data.results[i];
                            listing.push(dato.name);
                        }
                        process(listing);
                    }
                }, 'json');
            };

            $('#searchinput').typeahead({source: buscar_materia, updater: function(item) {
                var results = $("#searchinput").get(0).results;
                for (var i in results) {
                    var datos = results[i];
                    if (item==datos.name) {
                        profesor = datos.id;
                        location.href = "/aprobacion_nivelcerrado?profesorid="+datos.id;
                    }
                }
                return item;
            }});

            $(".btn-info").click(function() {
                idmateriaasig=$(this).attr("id");
                $("#motivopanel").modal('show');
                return false;
            });
               $("#selector").change(function() {
                var term =$("#selector").val();
                if (term >0) {
                    location.href = "/aprobacion_nivelcerrado?id="+term+"&profesorid={{ profesor.id }}";
                }

            });


            $("#motivopanel .btn-ejecutar").click(function(){
                $("#motivopanel").modal('hide');
                var tipomotivo = $("#motivopanel #seltrans").find('option:selected').attr('value');
                $.post("/aprobacion_nivelcerrado", {'action':'motivonota','matasignada': idmateriaasig,'tipomotivo':tipomotivo}, function(data) {
                    if (data.result=="ok") {
                        location.reload();
                    } else {
                        smoke.alert("Error en ingreso ");
                        location.reload();
                    }
                }, "json");
            });

            $("#motivopanel .btn-cerrar").click(function(){
                $("#motivopanel").modal('hide');
                $("#motivopanel #seltrans").val("");
                return false;
            });


            $(".btn-aprobar").click(function() {
                idmateriaasig=$(this).attr("matid");
                apruebaparciales =$(this).attr("parcial");
                apruebaexamen = '0';
                apruebarecuperacion = '0';
                $("#tipoaprobacionpanel #id_respuesta").val("");
                $("#tipoaprobacionpanel #id_aprobado").attr('checked',false);
                $("#tipoaprobacionpanel #id_reprobado").attr('checked',false);
                $("#tipoaprobacionpanel").modal('show');
                return false;
            });

            $(".estadonota").click(function() {
                idmateriaasig=$(this).attr("matid");
                $.post("/aprobacion_nivelcerrado", {'action':'cambiodeestado','matasignada': idmateriaasig}, function(data) {
                        if (data.result=="ok") {
                            alert('REGISTRO GUARDADO');
                            location.reload();
                        } else {
                            smoke.alert("Error en ingreso ");
                        }
                }, "json");

            });

            $(".estadoparcial").click(function() {
                idmateriaasig=$(this).attr("matid");
                $.post("/aprobacion_nivelcerrado", {'action':'quitaaprobacionparcial','matasignada': idmateriaasig}, function(data) {
                        if (data.result=="ok") {
                            alert('REGISTRO GUARDADO');
                            location.reload();
                        } else {
                            smoke.alert("Error en ingreso ");
                        }
                }, "json");

            });

            $(".estadoexamen").click(function() {
                idmateriaasig=$(this).attr("matid");
                $.post("/aprobacion_nivelcerrado", {'action':'quitaaprobacionexamen','matasignada': idmateriaasig}, function(data) {
                        if (data.result=="ok") {
                            alert('REGISTRO GUARDADO');
                            location.reload();
                        } else {
                            smoke.alert("Error en ingreso ");
                        }
                }, "json");

            });

            $(".estadorecuperacion").click(function() {
                idmateriaasig=$(this).attr("matid");
                $.post("/aprobacion_nivelcerrado", {'action':'quitaaprobacionrecuperacion','matasignada': idmateriaasig}, function(data) {
                        if (data.result=="ok") {
                            alert('REGISTRO GUARDADO');
                            location.reload();
                        } else {
                            smoke.alert("Error en ingreso ");
                        }
                }, "json");

            });

            $(".btn-aprobarexa").click(function() {
                idmateriaasig=$(this).attr("matid");
                apruebaparciales ='0';
                apruebaexamen = $(this).attr("exa");
                apruebarecuperacion = '0';

                $("#tipoaprobacionpanel #id_respuesta").val("");
                $("#tipoaprobacionpanel #id_aprobado").attr('checked',false);
                $("#tipoaprobacionpanel #id_reprobado").attr('checked',false);
                $("#tipoaprobacionpanel").modal('show');
                return false;
            });

            $(".btn-aprobarrec").click(function() {
                idmateriaasig=$(this).attr("matid");
                apruebaparciales ='0';
                apruebaexamen = '0';
                apruebarecuperacion = $(this).attr("rec");

                $("#tipoaprobacionpanel #id_respuesta").val("");
                $("#tipoaprobacionpanel #id_aprobado").attr('checked',false);
                $("#tipoaprobacionpanel #id_reprobado").attr('checked',false);
                $("#tipoaprobacionpanel").modal('show');
                return false;
            });

            $("#tipoaprobacionpanel .btn-guardar").click(function(){
                $("#tipoaprobacionpanel").modal('hide');
                var aprobado = 0;
                var reprobado = 0;
                if ( (!$("#id_aprobado").is(':checked')) && (!$("#id_reprobado").is(':checked')) ) {
                        smoke.alert('DEBE APROBAR O NO EL CAMBIO');
                    }
                else{
                    if ($("#id_aprobado").is(':checked')){
                        aprobado = 1;
                    }
                    else{
                        aprobado = 0;
                    }
                    $.post("/aprobacion_nivelcerrado", {'action':'aprobacionnota','matasignada': idmateriaasig,'estado':aprobado,'obssecretaria': $('#id_respuesta').val(),'parciales':apruebaparciales,'examen':apruebaexamen,'recuperacion':apruebarecuperacion}, function(data) {
                        if (data.result=="ok") {
                            alert('REGISTRO GUARDADO');
                            location.reload();
                        } else {
                            smoke.alert("Error en ingreso ");
                        }
                    }, "json");
                }
            });

            $("#tipoaprobacionpanel .btn-cerrar").click(function(){
                $("#tipoaprobacionpanel #id_respuesta").val("");
                $("#tipoaprobacionpanel #id_aprobado").attr('checked',false);
                $("#tipoaprobacionpanel #id_reprobado").attr('checked',false);
                $("#tipoaprobacionpanel").modal('hide');
                return false;
            });

            $(".verobs").click(function() {
                var obs=$(this).attr("obs");
                smoke.alert(obs);
            });

            $(".vermot").click(function() {
                var mot=$(this).attr("mot");
                smoke.alert(mot);
            });

            $(".eliminaralcance").click(function() {
                var idalcan=$(this).attr("elimina");

               smoke.confirm("Desea eliminar el registro? ", function(e){
               if (e){
                   $.post("/aprobacion_nivelcerrado", {action: 'eliminaalcance', 'alcance': idalcan}, function(data) {
                   if (data.result=='ok') {
                        location.reload();
                        } else {
                        }
                   }, "json");
               }
               }, {
                    ok: "Si",
                    cancel: "No",
                    classname: "custom-class",
                    reverseButtons: true
               });
            });

        });

    </script>
{% endblock %}
{% block canvas %}
    <div class='row-fluid'>
        <div class='span8'>
            <h2 style="color: #0000ff">Aprobaci&oacute;n de Notas Nivel Cerrado </h2>
            <h3>
                {% if aprobadas and not noaprobadas and not todos %}Notas de Nivel Cerrado Aprobadas{% endif %}
                {% if noaprobadas and not aprobadas and not todos %}Notas de Nivel Cerrado Sin Aprobar{% endif %}
                {% if not aprobadas and not noaprobadas and not todos %}Notas de Nivel Cerrado
                    <br> {% if profesor %}Profesor:  {{ profesor.persona.nombre_completo  }}{% endif %}
                    <br> {% if materiaselec %}Materia: {{ materiaselec.asignatura.nombre }} - {{ materiaselec.nivel.paralelo }} - {{ materiaselec.nivel.nivelmalla.nombre }}{% endif %}
                    {% endif %}
                {% if todos and not aprobadas and not noaprobadas %}Aprobaci&oacute;n Alcance Nivel Cerrado {% endif %}
            </h3>
            <br>
        </div>
        <div class='span3'>
            {% if not aprobadas %}
                <a href="/aprobacion_nivelcerrado?aprob=aprobadas" id='allresults' class='btn btn-success'><i class="icon-eye-open icon-white"></i> Notas Aprobadas Nivel Cerrado</a>
                <a href="/aprobacion_nivelcerrado?t=1" id='allresults' class='btn btn-primary'><i class="icon-refresh icon-white"></i> Todos</a>
            {% else %}
                <a href="/aprobacion_nivelcerrado?noaprob=noaprobadas" id='allresults' class='btn btn-warning'><i class="icon-refresh icon-white"></i>Notas por Aprobar Nivel Cerrado</a>
                <a href="/aprobacion_nivelcerrado?t=1" id='allresults' class='btn btn-primary'><i class="icon-refresh icon-white"></i> Todos</a>
            {% endif %}
            <br><br>
        </div>
        <div class='span1'>
            <a href="/aprobacion_alcance_notas" class='btn'><i class="icon-arrow-left"></i> Atr&aacute;s</a>
        </div>
    </div>
    <br>
    <div class='row-fluid'>
        <div class="span12 atright" style="text-align: center;">
            <b>Profesor  </b>
            <input type="text" id="searchinput" value="{% if profesor %}{{ profesor.persona.nombre_completo }} {% endif %}" class="searchinput input-xxlarge search-query" data-provide="typeahead"/>

             <b>Materia </b>
               <select id="selector" class="input-xxlarge bigger">
                    <option value="">-----</option>
                    {% for m in materias %}
                <option  {% if mat == m.id %}selected="selected"{% endif %} value="{{ m.id }}" >{{ m.asignatura }} - {{ m.nivel.paralelo }} - {{ m.nivel.nivelmalla.nombre }}</option>
                    {% endfor %}
               </select>

        </div>
    </div>
    <br>

    <div class='row-fluid'>
        <div class='span12'>
            <table class='table table-bordered table-striped' cellpadding="0" cellspacing="0">
                <thead>
                <tr>
                    <th style="background-color: lightblue;text-align: center"><h3>Estudiante</h3></th>
                    <th style="background-color: lightblue;text-align: center"><h3>N1</h3> </th>
                    <th style="background-color: lightblue;text-align: center"><h3>N2 </h3></th>
                    <th style="background-color: lightblue;text-align: center"><h3>N3</h3></th>
                    <th style="background-color: lightblue;text-align: center"><h3>N4</h3></th>
                    <th style="background-color: lightblue;text-align: center"><h3>A.P.</h3></th>
                    <th style="background-color: lightblue;text-align: center"><h3>Exa</h3></th>
                    <th style="background-color: lightblue;text-align: center"><h3>A. E.</h3></th>
                    <th style="background-color: lightblue;text-align: center"><h3>Recup</h3></th>
                    <th style="background-color: lightblue;text-align: center"><h3>A. R.</h3></th>
                    <th style="background-color: lightblue;text-align: center"><h3>NFinal</h3></th>
                    <th style="background-color: lightblue;text-align: center"><h3>Asist</h3></th>
                    <th style="background-color: lightblue;text-align: center"><h3>Estado</h3></th>
                    <th></th>
                </tr>

                </thead>
                <tbody>

                    {% for evaal in evaalcance %}
                    {% with notatotal=evaal.nota_total_alcance asentamiento=evaal.materiaasignada.ver_asentamiento tieneexamen=evaal.materiaasignada.ver_examen tienerecuperacion=evaal.materiaasignada.ver_recuperacion verificacion=evaal.materiaasignada.ver_verificacion %}
                        <tr>
                            <td style="background-color: aliceblue; text-align: center">
                                {{ evaal.materiaasignada.matricula.inscripcion.persona.nombre_completo_inverso }} <span class="label label-warning"> {{ evaal.fecha|date:"d-m-Y" }}</span><br>
                                <span class="label label-info">{{ evaal.materiaasignada.asignacion}}</span><br>
                                <span class="label label-success">{{ evaal.profesor_alcance }}</span>
                            </td>
                            {% if evaal.materiaasignada.materia.cerrado and evaal.materiaasignada.materia.nivel.cerrado  %}
                                 {% if perms.sga.change_nivel %}
                                     {% if not evaal.aprobado and evaal.notasparciales %}
                                         <td>
                                             <b style="color: blue">{{ evaal.materiaasignada.evaluacion.n1 }}</b> <br>
                                             <input id='{{ evaal.materiaasignada.id }}' type="text" class="alcancenota1 input-mini bigger" style="{% if evaal %}background: lightcyan; font-weight: bold;{% endif %}" value="{{ evaal.n1 }}" maid='{{ evaal.materiaasignada.id }}' name='{{ evaal.materiaasignada.id }}' sel='alcance1'/>
                                         </td>
                                         <td>
                                            <b style="color: blue">{{ evaal.materiaasignada.evaluacion.n2 }}</b><br>
                                            <input id='{{ evaal.materiaasignada.id }}' type="text" class="alcancenota2 input-mini bigger" style="{% if evaal %}background: lightcyan; font-weight: bold;{% endif %}" value="{{ evaal.n2 }}" maid='{{ evaal.materiaasignada.id }}' name='{{ evaal.materiaasignada.id }}' sel='alcance2'/>
                                         </td>
                                         <td>
                                            <b style="color: blue">{{ evaal.materiaasignada.evaluacion.n3 }}</b><br>
                                            <input id='{{ evaal.materiaasignada.id }}' type="text" class="alcancenota3 input-mini bigger" style="{% if evaal %}background: lightcyan; font-weight: bold;{% endif %}" value="{{ evaal.n3 }}" maid='{{ evaal.materiaasignada.id }}' name='{{ evaal.materiaasignada.id }}' sel='alcance3'/>
                                         </td>
                                         <td>
                                            <b style="color: blue">{{ evaal.materiaasignada.evaluacion.n4 }}</b><br>
                                            <input id='{{ evaal.materiaasignada.id }}' type="text" class="alcancenota4 input-mini bigger" style="{% if evaal %}background: lightcyan; font-weight: bold;{% endif %}" value="{{ evaal.n4 }}" maid='{{ evaal.materiaasignada.id }}' name='{{ evaal.materiaasignada.id }}' sel='alcance4'/>
                                         </td>
                                     {% else %}
                                        <td>
                                            {{ evaal.materiaasignada.ver_historiconotas.n1 }}
                                        </td>
                                        <td>
                                            {{ evaal.materiaasignada.ver_historiconotas.n2 }}
                                        </td>
                                        <td>
                                            {{ evaal.materiaasignada.ver_historiconotas.n3 }}
                                        </td>
                                        <td>
                                            {{ evaal.materiaasignada.ver_historiconotas.n4 }}
                                        </td>
                                     {% endif %}

                                     <td style="text-align: center;">
                                        {% if evaal.notasparciales %}
                                            {%  if not evaal.aprobado %}
                                                <a href="#"matid='{{ evaal.materiaasignada.id }}' parcial='1' class='btn btn-aprobar btn-success' title="Aprobación de Notas Parciales"><i class="icon-check"></i></a>
                                            {% else %}
                                                {% if perms.sga.change_evaluacionalcance %}
                                                    <a href="#"matid='{{ evaal.materiaasignada.id }}' class='estadoparcial' title="Quita Aprobación Parciales"><img src='/static/images/16/true.png' alt='Si' border='0'/></a><br>
                                                {% else %}
                                                    <a href="#" title="Aprobación OK" class="estado"><img src='/static/images/16/true.png' alt='Si' border='0'/></a><br>
                                                {% endif %}
                                                <b style="color:green">{{ evaal.usuarioaprueba}}</b><br>
                                                <b style="color:green">{{ evaal.fechaaprobacion|date:"d-m-Y"}}</b>
                                            {% endif %}
                                        {% endif %}
                                     </td>
                                     <td>
                                        {% if evaal.materiaasignada.tiene_evaluacionalcance %}
                                            {% if evaal.observaciones and evaal.motivo and evaal.notaexamen and not evaal.aprobadoex  %}
                                                <b style="color: blue">{{ evaal.materiaasignada.evaluacion.examen }}</b><br>
                                                <input id='{{ evaal.materiaasignada.id }}' type="text" class="alcanceexamen input-mini bigger" style="{% if evaal.materiaasignada.tiene_evaluacionalcance %}background: lightcyan; font-weight: bold;{% endif %}" value="{{ evaal.examen }}" maid='{{ evaal.materiaasignada.id }}' name='{{ evaal.materiaasignada.id }}' sel='alcanceexamen'/>
                                            {% else %}
                                                {{ evaal.materiaasignada.ver_historiconotas.n5 }}
                                            {% endif %}
                                        {% endif %}
                                     </td>
                                     <td style="text-align: center;">
                                        {% if evaal.notaexamen %}
                                            {%  if not evaal.aprobadoex %}
                                                <a href="#"matid='{{ evaal.materiaasignada.id }}'exa='1' class='btn btn-aprobarexa btn-success' title="Aprobación de Examen"><i class="icon-check"></i></a>
                                            {% else %}
                                                {% if perms.sga.change_evaluacionalcance %}
                                                     <a href="#"matid='{{ evaal.materiaasignada.id }}' class='estadoexamen' title="Quita Aprobación Examen"><img src='/static/images/16/true.png' alt='Si' border='0'/></a><br>
                                                {% else %}
                                                    <a href="#" title="Aprobación OK" class="estado"><img src='/static/images/16/true.png' alt='Si' border='0'/></a><br>
                                                {% endif %}
                                                <b style="color:green">{{ evaal.usuarioapruebaex}}</b><br>
                                                <b style="color:green">{{ evaal.fechaaprobacionex|date:"d-m-Y"}}</b>
                                            {% endif %}
                                        {% else %}
                                            {%  if evaal.aprobadoex %}
                                                {% if perms.sga.change_evaluacionalcance %}
                                                     <a href="#"matid='{{ evaal.materiaasignada.id }}' class='estadoexamen' title="Quita Aprobación Examen"><img src='/static/images/16/true.png' alt='Si' border='0'/></a><br>
                                                {% endif %}
                                                <b style="color:green">{{ evaal.usuarioapruebaex}}</b><br>
                                                <b style="color:green">{{ evaal.fechaaprobacionex|date:"d-m-Y"}}</b>
                                            {% endif %}
                                        {% endif %}
                                     </td>
                                     <td>
                                        {% if evaal.materiaasignada.tiene_evaluacionalcance %}
                                            {% if evaal.observaciones and evaal.motivo and evaal.recuperacion and not evaal.aprobadorec %}
                                                <b style="color: blue">{{ evaal.materiaasignada.evaluacion.recuperacion }}</b><br>
                                                <input id='{{ evaal.materiaasignada.id }}' type="text" class="alcancerecupera input-mini bigger" style="{% if evaal.materiaasignada.tiene_evaluacionalcance %}background: lightcyan; font-weight: bold;{% endif %}" value="{{ evaal.recuperacion }}" maid='{{ evaal.materiaasignada.id }}' name='{{ evaal.materiaasignada.id }}' sel='alcancerecupera'/>
                                            {% else %}
                                                {{ evaal.materiaasignada.ver_historiconotas.recup }}
                                            {% endif %}
                                        {% endif %}
                                    </td>
                                    <td style="text-align: center;">
                                        {% if evaal.notarecuperacion %}
                                            {%  if not evaal.aprobadorec %}
                                                <a href="#"matid='{{ evaal.materiaasignada.id }}' rec='1' class='btn btn-aprobarrec btn-success'title="Aprobación de Recuperación"><i class="icon-check"></i> </a>
                                            {% else %}
                                                {% if perms.sga.change_evaluacionalcance %}
                                                     <a href="#"matid='{{ evaal.materiaasignada.id }}' class='estadorecuperacion' title="Quita Aprobación Recuperacion"><img src='/static/images/16/true.png' alt='Si' border='0'/></a><br>
                                                {% else %}
                                                    <a href="#" title="Aprobación OK" class="estado"><img src='/static/images/16/true.png' alt='Si' border='0'/></a><br>
                                                {% endif %}
                                                <b style="color:green">{{ evaal.usuarioapruebarec}}</b><br>
                                                <b style="color:green">{{ evaal.fechaaprobacionrec|date:"d-m-Y"}}</b>
                                            {% endif %}
                                        {% else %}
                                            {%  if evaal.aprobadorec %}
                                                {% if perms.sga.change_evaluacionalcance %}
                                                     <a href="#"matid='{{ evaal.materiaasignada.id }}' class='estadorecuperacion' title="Quita Aprobación Recuperacion"><img src='/static/images/16/true.png' alt='Si' border='0'/></a><br>
                                                {% endif %}
                                                <b style="color:green">{{ evaal.usuarioapruebarec}}</b><br>
                                                <b style="color:green">{{ evaal.fechaaprobacionrec|date:"d-m-Y"}}</b>
                                            {% endif %}
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ evaal.materiaasignada.ver_historiconotas.notafinal|floatformat }}
                                    </td>
                                    <td>
                                        {% if evaal.materiaasignada.ver_recordmateria.asistencia < asistencia_aprobar %} <span style="color: #dc143c;"><b>{{ evaal.materiaasignada.ver_recordmateria.asistencia|floatformat }}%</b></span>{% endif %}
                                        {% if evaal.materiaasignada.ver_recordmateria.asistencia >= asistencia_aprobar %} <span style="color:#006400;"><b>{{ evaal.materiaasignada.ver_recordmateria.asistencia|floatformat }}%</b></span>{% endif %}
                                    </td>
                                    <td>
                                        <b style="color: #0000ff" >{{ evaal.materiaasignada.ver_historiconotas.estado.nombre }}</b><br>
                                    </td>
                                    <td>
                                        <div class="btn-group">
                                            <a class="btn btn-mini dropdown-toggle" data-toggle="dropdown" href="#">
                                                Acciones
                                                <span class="caret"></span>
                                            </a>
                                                <ul class="dropdown-menu pull-right">
                                                    {%  if  evaal.observaciones %}
                                                        <li><a href="#" class="verobs" obs="{{ evaal.observaciones }}"><i class="icon-eye-open"></i> Ver Observaci&oacute;n</a></li>
                                                    {% endif %}
                                                    {%  if  evaal.motivo %}
                                                        <li><a href="#" class="vermot" mot="{{ evaal.motivo.motivo }}"><i class="icon-eye-open"></i> Ver Motivo</a></li>
                                                    {% endif %}
                                                    {% if perms.sga.change_nivel %}
                                                        {%  if not evaal.aprobado and not evaal.aprobadoex and not evaal.aprobadorec %}
                                                            <li><a href="#" class="eliminaralcance" elimina="{{ evaal.id }}"><i class="icon-check"></i> Eliminar</a></li>
                                                        {% endif %}
                                                    {% endif %}
                                                </ul>
                                        </div>
                                    </td>
                                {% else %}
                                    <td>
                                        {{ evaal.materiaasignada.ver_historiconotas.n1 }}
                                    </td>
                                    <td>
                                        {{ evaal.materiaasignada.ver_historiconotas.n2 }}
                                    </td>
                                    <td>
                                        {{ evaal.materiaasignada.ver_historiconotas.n3 }}
                                    </td>
                                    <td>
                                        {{ evaal.materiaasignada.ver_historiconotas.n4 }}
                                    </td>
                                    <td>
                                        {% if evaal.usuarioaprueba %}
                                            <b style="color:green">{{ evaal.usuarioaprueba}}</b><br>
                                            <b style="color:green">{{ evaal.fechaaprobacion|date:"d-m-Y"}}</b>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ evaal.materiaasignada.ver_historiconotas.n5 }}
                                    </td>
                                    <td>
                                        {% if evaal.usuarioapruebaex %}
                                            <b style="color:green">{{ evaal.usuarioapruebaex}}</b><br>
                                            <b style="color:green">{{ evaal.fechaaprobacionex|date:"d-m-Y"}}</b>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ evaal.materiaasignada.ver_historiconotas.recup }}
                                    </td>
                                    <td>
                                        {% if evaal.usuarioapruebarec %}
                                            <b style="color:green">{{ evaal.usuarioapruebarec}}</b><br>
                                            <b style="color:green">{{ evaal.fechaaprobacionrec|date:"d-m-Y"}}</b>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {{ evaal.materiaasignada.ver_historiconotas.notafinal|floatformat }}
                                    </td>
                                    <td>
                                        {% if evaal.materiaasignada.ver_recordmateria.asistencia < asistencia_aprobar %} <span style="color: #dc143c;"><b>{{ evaal.materiaasignada.ver_recordmateria.asistencia|floatformat }}%</b></span>{% endif %}
                                        {% if evaal.materiaasignada.ver_recordmateria.asistencia >= asistencia_aprobar %} <span style="color:#006400;"><b>{{ evaal.materiaasignada.ver_recordmateria.asistencia|floatformat }}%</b></span>{% endif %}
                                    </td>
                                    <td>
                                        <b style="color: #0000ff" >{{ evaal.materiaasignada.ver_historiconotas.estado.nombre }}</b><br>
                                    </td>
                                {% endif %}
                            {% endif %}
                        </tr>
                     {% endwith %}
                {% endfor %}
                {% if not evaalcance %}
                    <tr>
                        <td colspan="6" align='center'>NO EXISTEN REGISTROS</td>
                    </tr>
                {% endif %}
                </tbody>
            </table>
        </div>
    </div>

   <div class='row-fluid'>
        <div class="span12">
            {% if paging.num_pages > 10 %}
                <div class='pagination'>
                    <ul>
                        {% if paging.primera_pagina %}
                            <li><a href="/aprobacion_nivelcerrado?page=1">1</a></li>
                            <li><a href="/aprobacion_nivelcerrado?page={{ paging.ellipsis_izquierda }}" class="active">...</a></li>
                        {% endif %}
                        {% for pagenumber in paging.paginas %}
                            <li {% if pagenumber == page.number %}class='active'{% endif %}><a href="/aprobacion_nivelcerrado?page={{ pagenumber }}{% if activos %}&a={{ activos }}{% endif %}{% if inactivos %}&i={{ inactivos }}{% endif %}{% if search %}&s={{ search }}{% endif %}{% if todos %}&t={{ todos }}{% endif %}{% if grupoid %}&g={{ grupoid }}{% endif %}{% if aprobadas %}&aprob={{ aprobadas }}{% endif %}{% if noaprobadas %}&noaprob={{ noaprobadas }}{% endif %}{% if profesor %}&profesorid={{ profesor.id }}{% endif %}{% if mat %}&id={{ mat }}{% endif %}">{{ pagenumber }}</a></li>
                        {% endfor %}
                        {% if paging.ultima_pagina %}
                            <li><a href="/aprobacion_nivelcerrado?page={{ paging.ellipsis_derecha }}{% if search %}&s={{ search }}{% endif %}{% if aprobadas %}&aprob={{ aprobadas }}{% endif %}{% if noaprobadas %}&noaprob={{ noaprobadas }}{% endif %}{% if profesor %}&profesorid={{ profesor.id }}{% endif %}{% if mat %}&id={{ mat }}{% endif %} " class="active">...</a></li>
                            <li><a href="/aprobacion_nivelcerrado?page={{ paging.num_pages }}{% if search %}&s={{ search }}{% endif %}{% if aprobadas %}&aprob={{ aprobadas }}{% endif %}{% if noaprobadas %}&noaprob={{ noaprobadas }}{% endif %}{% if profesor %}&profesorid={{ profesor.id }}{% endif %}{% if mat %}&id={{ mat }}{% endif %}">{{ paging.num_pages }}</a></li>
                        {% endif %}
                    </ul>
                </div>
            {% else %}

                <div class='pagination'>
                    <ul>
                        {% for pagenumber in paging.page_range %}
                            <li {% if pagenumber == page.number %}class='active'{% endif %}><a href="/aprobacion_nivelcerrado?{% if search %}s={{ search }}&{% endif %}page={{ pagenumber }}{% if activos %}&a={{ activos }}{% endif %}{% if inactivos %}&i={{ inactivos }}{% endif %}{% if todos %}&t={{ todos }}{% endif %}{% if grupoid %}&g={{ grupoid }}{% endif %}{% if aprobadas %}&aprob={{ aprobadas }}{% endif %}{% if noaprobadas %}&noaprob={{ noaprobadas }}{% endif %}{% if profesor %}&profesorid={{ profesor.id }}{% endif %}{% if mat %}&id={{ mat }}{% endif %}">{{ pagenumber }}</a></li>
                        {% endfor %}
                    </ul>
                </div>

            {% endif %}

        </div>
    </div>


{% endblock %}

{% block moreblock %}


    <div class="modal fade static" id="tipoaprobacionpanel" style="width: 100px;">
            <div class="modal-header">
                <div id="paneltitle"></div>
            </div>
            <div class="modal-body" style="height: 500px;">
                <form id="formulario5"  action="" method="POST">
                {% for field in aprobacionform %}
                    <fieldset class="control-group nomargins">
                    <label style="text-align: left;"  for="id_{{ field.name }}"><b>{{ field.label }}:</b></label>
                        <div class="controls">
                            {{ field }}
                            <p class="help-text">{{ field.help_text }} </p>
                        </div>
                    </fieldset>
                {% endfor %}
                </form>
            </div>
            <div class="modal-footer">
                <a href="#" class="btn btn-guardar btn-success"> <b> Aceptar</b></a>
                <a href="#" class="btn btn-cerrar btn-warning">Salir</a>
            </div>
    </div>

{% endblock %}